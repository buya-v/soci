const o="soci_twitter_auth";function l(){const e=a();return e!==null&&e.expires_at>Date.now()}function a(){try{const e=localStorage.getItem(o);return e?JSON.parse(e):null}catch{return null}}function u(e){localStorage.setItem(o,JSON.stringify(e))}function c(){localStorage.removeItem(o)}function w(){window.location.href="/api/auth/twitter/authorize"}function h(){const e=new URLSearchParams(window.location.search),n=e.get("twitter_auth"),t=e.get("data"),r=e.get("error");if((n||r)&&window.history.replaceState({},"",window.location.pathname),r)return{success:!1,error:decodeURIComponent(r)};if(n==="success"&&t)try{const s=JSON.parse(atob(t)),i={access_token:s.access_token,refresh_token:s.refresh_token,expires_at:Date.now()+s.expires_in*1e3,username:s.username,user_id:s.user_id};return u(i),{success:!0,username:i.username}}catch{return{success:!1,error:"Failed to parse authentication data"}}return{success:!1}}async function f(){const e=a();if(!e)return null;if(e.expires_at-Date.now()<5*60*1e3)try{const n=await fetch("/api/twitter/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refresh_token})});if(!n.ok)return c(),null;const t=await n.json(),r={...e,access_token:t.access_token,refresh_token:t.refresh_token||e.refresh_token,expires_at:Date.now()+t.expires_in*1e3};return u(r),r.access_token}catch{return e.access_token}return e.access_token}async function d(e){const n=await f();if(!n)return{success:!1,error:"Not connected to Twitter. Please connect your account."};try{const t=await fetch("/api/twitter/tweet",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({text:e})}),r=await t.json();return t.ok?{success:!0,tweet:r.tweet}:t.status===401?(c(),{success:!1,error:"Session expired. Please reconnect your Twitter account."}):{success:!1,error:r.error||"Failed to post tweet"}}catch{return{success:!1,error:"Network error. Please try again."}}}function p(){c()}function _(){const e=a();return(e==null?void 0:e.username)||null}export{w as c,p as d,_ as g,h,l as i,d as p};
