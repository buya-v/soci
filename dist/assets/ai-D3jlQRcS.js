function w(s,e,t,n,r){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t}function d(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)}let Fa=function(){const{crypto:s}=globalThis;if(s!=null&&s.randomUUID)return Fa=s.randomUUID.bind(s),s.randomUUID();const e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function Pt(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}const As=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){const e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};class $ extends Error{}let ae=class xs extends ${constructor(e,t,n,r){super(`${xs.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r==null?void 0:r.get("request-id"),this.error=t}static makeMessage(e,t,n){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new qn({message:n,cause:As(t)});const a=t;return e===400?new Ua(e,a,n,r):e===401?new ja(e,a,n,r):e===403?new qa(e,a,n,r):e===404?new Wa(e,a,n,r):e===409?new Ha(e,a,n,r):e===422?new Ja(e,a,n,r):e===429?new Ga(e,a,n,r):e>=500?new Xa(e,a,n,r):new xs(e,a,n,r)}},ue=class extends ae{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},qn=class extends ae{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Da=class extends qn{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ua=class extends ae{},ja=class extends ae{},qa=class extends ae{},Wa=class extends ae{},Ha=class extends ae{},Ja=class extends ae{},Ga=class extends ae{},Xa=class extends ae{};const cc=/^[a-z][a-z0-9+.-]*:/i,lc=s=>cc.test(s);let Rs=s=>(Rs=Array.isArray,Rs(s)),Ar=Rs;function Es(s){return typeof s!="object"?{}:s??{}}function uc(s){if(!s)return!0;for(const e in s)return!1;return!0}function hc(s,e){return Object.prototype.hasOwnProperty.call(s,e)}const dc=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new $(`${s} must be an integer`);if(e<0)throw new $(`${s} must be a positive integer`);return e},Ka=s=>{try{return JSON.parse(s)}catch{return}},fc=s=>new Promise(e=>setTimeout(e,s)),Ge="0.71.2",mc=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function gc(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const pc=()=>{var t;const s=gc();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":Rr(Deno.build.os),"X-Stainless-Arch":xr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":Rr(globalThis.process.platform??"unknown"),"X-Stainless-Arch":xr(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=_c();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ge,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function _c(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${r}.${a}.${i}`}}}return null}const xr=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Rr=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let Er;const yc=()=>Er??(Er=pc());function wc(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Va(...s){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function Ya(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return Va({start(){},async pull(t){const{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function Hs(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function bc(s){var n,r;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((r=(n=s[Symbol.asyncIterator]()).return)==null?void 0:r.call(n));return}const e=s.getReader(),t=e.cancel();e.releaseLock(),await t}const Sc=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function Ac(s){let e=0;for(const r of s)e+=r.length;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.length;return t}let vr;function Js(s){let e;return(vr??(e=new globalThis.TextEncoder,vr=e.encode.bind(e)))(s)}let kr;function $r(s){let e;return(kr??(e=new globalThis.TextDecoder,kr=e.decode.bind(e)))(s)}var ee,te;let Dt=class{constructor(){ee.set(this,void 0),te.set(this,void 0),w(this,ee,new Uint8Array),w(this,te,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Js(e):e;w(this,ee,Ac([d(this,ee,"f"),t]));const n=[];let r;for(;(r=xc(d(this,ee,"f"),d(this,te,"f")))!=null;){if(r.carriage&&d(this,te,"f")==null){w(this,te,r.index);continue}if(d(this,te,"f")!=null&&(r.index!==d(this,te,"f")+1||r.carriage)){n.push($r(d(this,ee,"f").subarray(0,d(this,te,"f")-1))),w(this,ee,d(this,ee,"f").subarray(d(this,te,"f"))),w(this,te,null);continue}const a=d(this,te,"f")!==null?r.preceding-1:r.preceding,i=$r(d(this,ee,"f").subarray(0,a));n.push(i),w(this,ee,d(this,ee,"f").subarray(r.index)),w(this,te,null)}return n}flush(){return d(this,ee,"f").length?this.decode(`
`):[]}};ee=new WeakMap,te=new WeakMap;Dt.NEWLINE_CHARS=new Set([`
`,"\r"]);Dt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function xc(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function Rc(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}const $n={off:0,error:200,warn:300,info:400,debug:500},Cr=(s,e,t)=>{if(s){if(hc($n,s))return s;Y(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys($n))}`)}};function yt(){}function Gt(s,e,t){return!e||$n[s]>$n[t]?yt:e[s].bind(e)}const Ec={error:yt,warn:yt,info:yt,debug:yt};let Ir=new WeakMap;function Y(s){const e=s.logger,t=s.logLevel??"off";if(!e)return Ec;const n=Ir.get(e);if(n&&n[0]===t)return n[1];const r={error:Gt("error",e,t),warn:Gt("warn",e,t),info:Gt("info",e,t),debug:Gt("debug",e,t)};return Ir.set(e,[t,r]),r}const Ie=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var nt;let Nt=class wt{constructor(e,t,n){this.iterator=e,nt.set(this,void 0),this.controller=t,w(this,nt,n)}static fromSSEResponse(e,t,n){let r=!1;const a=n?Y(n):console;async function*i(){if(r)throw new $("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const c of vc(e,t)){if(c.event==="completion")try{yield JSON.parse(c.data)}catch(l){throw a.error("Could not parse message into JSON:",c.data),a.error("From chunk:",c.raw),l}if(c.event==="message_start"||c.event==="message_delta"||c.event==="message_stop"||c.event==="content_block_start"||c.event==="content_block_delta"||c.event==="content_block_stop")try{yield JSON.parse(c.data)}catch(l){throw a.error("Could not parse message into JSON:",c.data),a.error("From chunk:",c.raw),l}if(c.event!=="ping"&&c.event==="error")throw new ae(void 0,Ka(c.data)??c.data,void 0,e.headers)}o=!0}catch(c){if(Pt(c))return;throw c}finally{o||t.abort()}}return new wt(i,t,n)}static fromReadableStream(e,t,n){let r=!1;async function*a(){const o=new Dt,c=Hs(e);for await(const l of c)for(const m of o.decode(l))yield m;for(const l of o.flush())yield l}async function*i(){if(r)throw new $("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const c of a())o||c&&(yield JSON.parse(c));o=!0}catch(c){if(Pt(c))return;throw c}finally{o||t.abort()}}return new wt(i,t,n)}[(nt=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new wt(()=>r(e),this.controller,d(this,nt,"f")),new wt(()=>r(t),this.controller,d(this,nt,"f"))]}toReadableStream(){const e=this;let t;return Va({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:r,done:a}=await t.next();if(a)return n.close();const i=Js(JSON.stringify(r)+`
`);n.enqueue(i)}catch(r){n.error(r)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}};async function*vc(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new $("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new $("Attempted to iterate over a response with no body");const t=new $c,n=new Dt,r=Hs(s.body);for await(const a of kc(r))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*kc(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Js(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=Rc(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}let $c=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=Cc(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}};function Cc(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function za(s,e){const{response:t,requestLogID:n,retryOfRequestLogID:r,startTime:a}=e,i=await(async()=>{var f;if(e.options.stream)return Y(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Nt.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),c=(f=o==null?void 0:o.split(";")[0])==null?void 0:f.trim();if((c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))){const g=await t.json();return Qa(g,t)}return await t.text()})();return Y(s).debug(`[${n}] response parsed`,Ie({retryOfRequestLogID:r,url:t.url,status:t.status,body:i,durationMs:Date.now()-a})),i}function Qa(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var bt;let Za=class ei extends Promise{constructor(e,t,n=za){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n,bt.set(this,void 0),w(this,bt,e)}_thenUnwrap(e){return new ei(d(this,bt,"f"),this.responsePromise,async(t,n)=>Qa(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(d(this,bt,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};bt=new WeakMap;var Xt;let ti=class{constructor(e,t,n,r){Xt.set(this,void 0),w(this,Xt,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new $("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await d(this,Xt,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Xt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},Ic=class extends Za{constructor(e,t,n){super(e,t,async(r,a)=>new n(r,a.response,await za(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}},Ut=class extends ti{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.first_id=n.first_id||null,this.last_id=n.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var t;if((t=this.options.query)!=null&&t.before_id){const n=this.first_id;return n?{...this.options,query:{...Es(this.options.query),before_id:n}}:null}const e=this.last_id;return e?{...this.options,query:{...Es(this.options.query),after_id:e}}:null}};class ni extends ti{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.next_page=n.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.next_page;return e?{...this.options,query:{...Es(this.options.query),page:e}}:null}}const si=()=>{var s;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((s=e==null?void 0:e.versions)==null?void 0:s.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Qe(s,e,t){return si(),new File(s,e??"unknown_file",t)}function pn(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}const ri=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",Gs=async(s,e)=>({...s,body:await Tc(s.body,e)}),Or=new WeakMap;function Oc(s){const e=typeof s=="function"?s:s.fetch,t=Or.get(e);if(t)return t;const n=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch{return!0}})();return Or.set(e,n),n}const Tc=async(s,e)=>{if(!await Oc(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(s||{}).map(([n,r])=>vs(t,n,r))),t},Mc=s=>s instanceof Blob&&"name"in s,vs=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response){let n={};const r=t.headers.get("Content-Type");r&&(n={type:r}),s.append(e,Qe([await t.blob()],pn(t),n))}else if(ri(t))s.append(e,Qe([await new Response(Ya(t)).blob()],pn(t)));else if(Mc(t))s.append(e,Qe([t],pn(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(n=>vs(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>vs(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},ai=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",Pc=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&ai(s),Nc=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function Lc(s,e,t){if(si(),s=await s,e||(e=pn(s)),Pc(s))return s instanceof File&&e==null&&t==null?s:Qe([await s.arrayBuffer()],e??s.name,{type:s.type,lastModified:s.lastModified,...t});if(Nc(s)){const r=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),Qe(await ks(r),e,t)}const n=await ks(s);if(!(t!=null&&t.type)){const r=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return Qe(n,e,t)}async function ks(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(ai(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(ri(s))for await(const n of s)e.push(...await ks(n));else{const n=(t=s==null?void 0:s.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof s}${n?`; constructor: ${n}`:""}${Bc(s)}`)}return e}function Bc(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}let he=class{constructor(e){this._client=e}};const ii=Symbol.for("brand.privateNullableHeaders");function*Fc(s){if(!s)return;if(ii in s){const{values:n,nulls:r}=s;yield*n.entries();for(const a of r)yield[a,null];return}let e=!1,t;s instanceof Headers?t=s.entries():Ar(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let n of t){const r=n[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=Ar(n[1])?n[1]:[n[1]];let i=!1;for(const o of a)o!==void 0&&(e&&!i&&(i=!0,yield[r,null]),yield[r,o])}}const O=s=>{const e=new Headers,t=new Set;for(const n of s){const r=new Set;for(const[a,i]of Fc(n)){const o=a.toLowerCase();r.has(o)||(e.delete(a),r.add(o)),i===null?(e.delete(a),t.add(o)):(e.append(a,i),t.delete(o))}}return{[ii]:!0,values:e,nulls:t}};function oi(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Tr=Object.freeze(Object.create(null)),Dc=(s=oi)=>function(t,...n){if(t.length===1)return t[0];let r=!1;const a=[],i=t.reduce((m,f,g)=>{var y;/[?#]/.test(f)&&(r=!0);const u=n[g];let _=(r?encodeURIComponent:s)(""+u);return g!==n.length&&(u==null||typeof u=="object"&&u.toString===((y=Object.getPrototypeOf(Object.getPrototypeOf(u.hasOwnProperty??Tr)??Tr))==null?void 0:y.toString))&&(_=u+"",a.push({start:m.length+f.length,length:_.length,error:`Value of type ${Object.prototype.toString.call(u).slice(8,-1)} is not a valid path parameter`})),m+f+(g===n.length?"":_)},""),o=i.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let l;for(;(l=c.exec(o))!==null;)a.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(a.sort((m,f)=>m.start-f.start),a.length>0){let m=0;const f=a.reduce((g,u)=>{const _=" ".repeat(u.start-m),y="^".repeat(u.length);return m=u.start+u.length,g+_+y},"");throw new $(`Path parameters result in path with invalid segments:
${a.map(g=>g.error).join(`
`)}
${i}
${f}`)}return i},G=Dc(oi);let ci=class extends he{list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/files",Ut,{query:r,...t,headers:O([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])})}delete(e,t={},n){const{betas:r}=t??{};return this._client.delete(G`/v1/files/${e}`,{...n,headers:O([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},n==null?void 0:n.headers])})}download(e,t={},n){const{betas:r}=t??{};return this._client.get(G`/v1/files/${e}/content`,{...n,headers:O([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},n){const{betas:r}=t??{};return this._client.get(G`/v1/files/${e}`,{...n,headers:O([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},n==null?void 0:n.headers])})}upload(e,t){const{betas:n,...r}=e;return this._client.post("/v1/files",Gs({body:r,...t,headers:O([{"anthropic-beta":[...n??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])},this._client))}},li=class extends he{retrieve(e,t={},n){const{betas:r}=t??{};return this._client.get(G`/v1/models/${e}?beta=true`,{...n,headers:O([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},n==null?void 0:n.headers])})}list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/models?beta=true",Ut,{query:r,...t,headers:O([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},t==null?void 0:t.headers])})}};const ui={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function Mr(s,e,t){return!e||!("parse"in(e.output_format??{}))?{...s,content:s.content.map(n=>{if(n.type==="text"){const r=Object.defineProperty({...n},"parsed_output",{value:null,enumerable:!1});return Object.defineProperty(r,"parsed",{get(){return t.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),null},enumerable:!1})}return n}),parsed_output:null}:hi(s,e,t)}function hi(s,e,t){let n=null;const r=s.content.map(a=>{if(a.type==="text"){const i=Uc(e,a.text);n===null&&(n=i);const o=Object.defineProperty({...a},"parsed_output",{value:i,enumerable:!1});return Object.defineProperty(o,"parsed",{get(){return t.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),i},enumerable:!1})}return a});return{...s,content:r,parsed_output:n}}function Uc(s,e){var t;if(((t=s.output_format)==null?void 0:t.type)!=="json_schema")return null;try{return"parse"in s.output_format?s.output_format.parse(e):JSON.parse(e)}catch(n){throw new $(`Failed to parse structured output: ${n}`)}}const jc=s=>{let e=0,t=[];for(;e<s.length;){let n=s[e];if(n==="\\"){e++;continue}if(n==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(n==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(n==="["){t.push({type:"paren",value:"["}),e++;continue}if(n==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(n===":"){t.push({type:"separator",value:":"}),e++;continue}if(n===","){t.push({type:"delimiter",value:","}),e++;continue}if(n==='"'){let o="",c=!1;for(n=s[++e];n!=='"';){if(e===s.length){c=!0;break}if(n==="\\"){if(e++,e===s.length){c=!0;break}o+=n+s[e],n=s[++e]}else o+=n,n=s[++e]}n=s[++e],c||t.push({type:"string",value:o});continue}if(n&&/\s/.test(n)){e++;continue}let a=/[0-9]/;if(n&&a.test(n)||n==="-"||n==="."){let o="";for(n==="-"&&(o+=n,n=s[++e]);n&&a.test(n)||n===".";)o+=n,n=s[++e];t.push({type:"number",value:o});continue}let i=/[a-z]/i;if(n&&i.test(n)){let o="";for(;n&&i.test(n)&&e!==s.length;)o+=n,n=s[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},Xe=s=>{if(s.length===0)return s;let e=s[s.length-1];switch(e.type){case"separator":return s=s.slice(0,s.length-1),Xe(s);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return s=s.slice(0,s.length-1),Xe(s);case"string":let n=s[s.length-2];if((n==null?void 0:n.type)==="delimiter")return s=s.slice(0,s.length-1),Xe(s);if((n==null?void 0:n.type)==="brace"&&n.value==="{")return s=s.slice(0,s.length-1),Xe(s);break;case"delimiter":return s=s.slice(0,s.length-1),Xe(s)}return s},qc=s=>{let e=[];return s.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?s.push({type:"brace",value:"}"}):t==="]"&&s.push({type:"paren",value:"]"})}),s},Wc=s=>{let e="";return s.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},di=s=>JSON.parse(Wc(qc(Xe(jc(s)))));var ie,be,Ue,st,Kt,rt,at,Vt,it,ge,ot,Yt,zt,ke,Qt,Zt,ct,ss,Pr,en,rs,as,is,Nr;const Lr="__json_buf";function Br(s){return s.type==="tool_use"||s.type==="server_tool_use"||s.type==="mcp_tool_use"}class Cn{constructor(e,t){ie.add(this),this.messages=[],this.receivedMessages=[],be.set(this,void 0),Ue.set(this,null),this.controller=new AbortController,st.set(this,void 0),Kt.set(this,()=>{}),rt.set(this,()=>{}),at.set(this,void 0),Vt.set(this,()=>{}),it.set(this,()=>{}),ge.set(this,{}),ot.set(this,!1),Yt.set(this,!1),zt.set(this,!1),ke.set(this,!1),Qt.set(this,void 0),Zt.set(this,void 0),ct.set(this,void 0),en.set(this,n=>{if(w(this,Yt,!0),Pt(n)&&(n=new ue),n instanceof ue)return w(this,zt,!0),this._emit("abort",n);if(n instanceof $)return this._emit("error",n);if(n instanceof Error){const r=new $(n.message);return r.cause=n,this._emit("error",r)}return this._emit("error",new $(String(n)))}),w(this,st,new Promise((n,r)=>{w(this,Kt,n,"f"),w(this,rt,r,"f")})),w(this,at,new Promise((n,r)=>{w(this,Vt,n,"f"),w(this,it,r,"f")})),d(this,st,"f").catch(()=>{}),d(this,at,"f").catch(()=>{}),w(this,Ue,e),w(this,ct,(t==null?void 0:t.logger)??console)}get response(){return d(this,Qt,"f")}get request_id(){return d(this,Zt,"f")}async withResponse(){w(this,ke,!0);const e=await d(this,st,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Cn(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n,{logger:r}={}){const a=new Cn(t,{logger:r});for(const i of t.messages)a._addMessageParam(i);return w(a,Ue,{...t,stream:!0}),a._run(()=>a._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),a}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},d(this,en,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var i;const r=n==null?void 0:n.signal;let a;r&&(r.aborted&&this.controller.abort(),a=this.controller.abort.bind(this.controller),r.addEventListener("abort",a));try{d(this,ie,"m",rs).call(this);const{response:o,data:c}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(o);for await(const l of c)d(this,ie,"m",as).call(this,l);if((i=c.controller.signal)!=null&&i.aborted)throw new ue;d(this,ie,"m",is).call(this)}finally{r&&a&&r.removeEventListener("abort",a)}}_connected(e){this.ended||(w(this,Qt,e),w(this,Zt,e==null?void 0:e.headers.get("request-id")),d(this,Kt,"f").call(this,e),this._emit("connect"))}get ended(){return d(this,ot,"f")}get errored(){return d(this,Yt,"f")}get aborted(){return d(this,zt,"f")}abort(){this.controller.abort()}on(e,t){return(d(this,ge,"f")[e]||(d(this,ge,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=d(this,ge,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(d(this,ge,"f")[e]||(d(this,ge,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{w(this,ke,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){w(this,ke,!0),await d(this,at,"f")}get currentMessage(){return d(this,be,"f")}async finalMessage(){return await this.done(),d(this,ie,"m",ss).call(this)}async finalText(){return await this.done(),d(this,ie,"m",Pr).call(this)}_emit(e,...t){if(d(this,ot,"f"))return;e==="end"&&(w(this,ot,!0),d(this,Vt,"f").call(this));const n=d(this,ge,"f")[e];if(n&&(d(this,ge,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!d(this,ke,"f")&&!(n!=null&&n.length)&&Promise.reject(r),d(this,rt,"f").call(this,r),d(this,it,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!d(this,ke,"f")&&!(n!=null&&n.length)&&Promise.reject(r),d(this,rt,"f").call(this,r),d(this,it,"f").call(this,r),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",d(this,ie,"m",ss).call(this))}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;let r;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{d(this,ie,"m",rs).call(this),this._connected(null);const i=Nt.fromReadableStream(e,this.controller);for await(const o of i)d(this,ie,"m",as).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new ue;d(this,ie,"m",is).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}[(be=new WeakMap,Ue=new WeakMap,st=new WeakMap,Kt=new WeakMap,rt=new WeakMap,at=new WeakMap,Vt=new WeakMap,it=new WeakMap,ge=new WeakMap,ot=new WeakMap,Yt=new WeakMap,zt=new WeakMap,ke=new WeakMap,Qt=new WeakMap,Zt=new WeakMap,ct=new WeakMap,en=new WeakMap,ie=new WeakSet,ss=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Pr=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new $("stream ended without producing a content block with type=text");return t.join(" ")},rs=function(){this.ended||w(this,be,void 0)},as=function(t){if(this.ended)return;const n=d(this,ie,"m",Nr).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const r=n.content.at(-1);switch(t.delta.type){case"text_delta":{r.type==="text"&&this._emit("text",t.delta.text,r.text||"");break}case"citations_delta":{r.type==="text"&&this._emit("citation",t.delta.citation,r.citations??[]);break}case"input_json_delta":{Br(r)&&r.input&&this._emit("inputJson",t.delta.partial_json,r.input);break}case"thinking_delta":{r.type==="thinking"&&this._emit("thinking",t.delta.thinking,r.thinking);break}case"signature_delta":{r.type==="thinking"&&this._emit("signature",r.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(Mr(n,d(this,Ue,"f"),{logger:d(this,ct,"f")}),!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{w(this,be,n);break}}},is=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");const t=d(this,be,"f");if(!t)throw new $("request ended without sending any chunks");return w(this,be,void 0),Mr(t,d(this,Ue,"f"),{logger:d(this,ct,"f")})},Nr=function(t){let n=d(this,be,"f");if(t.type==="message_start"){if(n)throw new $(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new $(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.container=t.delta.container,n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,n.context_management=t.context_management,t.usage.input_tokens!=null&&(n.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(n.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(n.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(n.usage.server_tool_use=t.usage.server_tool_use),n;case"content_block_start":return n.content.push(t.content_block),n;case"content_block_delta":{const r=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(r==null?void 0:r.type)==="text"&&(n.content[t.index]={...r,text:(r.text||"")+t.delta.text});break}case"citations_delta":{(r==null?void 0:r.type)==="text"&&(n.content[t.index]={...r,citations:[...r.citations??[],t.delta.citation]});break}case"input_json_delta":{if(r&&Br(r)){let a=r[Lr]||"";a+=t.delta.partial_json;const i={...r};if(Object.defineProperty(i,Lr,{value:a,enumerable:!1,writable:!0}),a)try{i.input=di(a)}catch(o){const c=new $(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${o}. JSON: ${a}`);d(this,en,"f").call(this,c)}n.content[t.index]=i}break}case"thinking_delta":{(r==null?void 0:r.type)==="thinking"&&(n.content[t.index]={...r,thinking:r.thinking+t.delta.thinking});break}case"signature_delta":{(r==null?void 0:r.type)==="thinking"&&(n.content[t.index]={...r,signature:t.delta.signature});break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Nt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const Hc=1e5,Jc=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeâ€”err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;var lt,je,$e,j,ut,Z,we,Se,ht,Fr,$s;function Dr(){let s,e;return{promise:new Promise((n,r)=>{s=n,e=r}),resolve:s,reject:e}}class fi{constructor(e,t,n){lt.add(this),this.client=e,je.set(this,!1),$e.set(this,!1),j.set(this,void 0),ut.set(this,void 0),Z.set(this,void 0),we.set(this,void 0),Se.set(this,void 0),ht.set(this,0),w(this,j,{params:{...t,messages:structuredClone(t.messages)}}),w(this,ut,{...n,headers:O([{"x-stainless-helper":"BetaToolRunner"},n==null?void 0:n.headers])}),w(this,Se,Dr())}async*[(je=new WeakMap,$e=new WeakMap,j=new WeakMap,ut=new WeakMap,Z=new WeakMap,we=new WeakMap,Se=new WeakMap,ht=new WeakMap,lt=new WeakSet,Fr=async function(){var l;const t=d(this,j,"f").params.compactionControl;if(!t||!t.enabled)return!1;let n=0;if(d(this,Z,"f")!==void 0)try{const m=await d(this,Z,"f");n=m.usage.input_tokens+(m.usage.cache_creation_input_tokens??0)+(m.usage.cache_read_input_tokens??0)+m.usage.output_tokens}catch{return!1}const r=t.contextTokenThreshold??Hc;if(n<r)return!1;const a=t.model??d(this,j,"f").params.model,i=t.summaryPrompt??Jc,o=d(this,j,"f").params.messages;if(o[o.length-1].role==="assistant"){const m=o[o.length-1];if(Array.isArray(m.content)){const f=m.content.filter(g=>g.type!=="tool_use");f.length===0?o.pop():m.content=f}}const c=await this.client.beta.messages.create({model:a,messages:[...o,{role:"user",content:[{type:"text",text:i}]}],max_tokens:d(this,j,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(((l=c.content[0])==null?void 0:l.type)!=="text")throw new $("Expected text response for compaction");return d(this,j,"f").params.messages=[{role:"user",content:c.content}],!0},Symbol.asyncIterator)](){var e;if(d(this,je,"f"))throw new $("Cannot iterate over a consumed stream");w(this,je,!0),w(this,$e,!0),w(this,we,void 0);try{for(;;){let t;try{if(d(this,j,"f").params.max_iterations&&d(this,ht,"f")>=d(this,j,"f").params.max_iterations)break;w(this,$e,!1,"f"),w(this,we,void 0,"f"),w(this,ht,(e=d(this,ht,"f"),e++,e),"f"),w(this,Z,void 0,"f");const{max_iterations:n,compactionControl:r,...a}=d(this,j,"f").params;if(a.stream?(t=this.client.beta.messages.stream({...a},d(this,ut,"f")),w(this,Z,t.finalMessage(),"f"),d(this,Z,"f").catch(()=>{}),yield t):(w(this,Z,this.client.beta.messages.create({...a,stream:!1},d(this,ut,"f")),"f"),yield d(this,Z,"f")),!await d(this,lt,"m",Fr).call(this)){if(!d(this,$e,"f")){const{role:c,content:l}=await d(this,Z,"f");d(this,j,"f").params.messages.push({role:c,content:l})}const o=await d(this,lt,"m",$s).call(this,d(this,j,"f").params.messages.at(-1));if(o)d(this,j,"f").params.messages.push(o);else if(!d(this,$e,"f"))break}}finally{t&&t.abort()}}if(!d(this,Z,"f"))throw new $("ToolRunner concluded without a message from the server");d(this,Se,"f").resolve(await d(this,Z,"f"))}catch(t){throw w(this,je,!1),d(this,Se,"f").promise.catch(()=>{}),d(this,Se,"f").reject(t),w(this,Se,Dr()),t}}setMessagesParams(e){typeof e=="function"?d(this,j,"f").params=e(d(this,j,"f").params):d(this,j,"f").params=e,w(this,$e,!0),w(this,we,void 0)}async generateToolResponse(){const e=await d(this,Z,"f")??this.params.messages.at(-1);return e?d(this,lt,"m",$s).call(this,e):null}done(){return d(this,Se,"f").promise}async runUntilDone(){if(!d(this,je,"f"))for await(const e of this);return this.done()}get params(){return d(this,j,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}$s=async function(e){return d(this,we,"f")!==void 0?d(this,we,"f"):(w(this,we,Gc(d(this,j,"f").params,e)),d(this,we,"f"))};async function Gc(s,e=s.messages.at(-1)){if(!e||e.role!=="assistant"||!e.content||typeof e.content=="string")return null;const t=e.content.filter(r=>r.type==="tool_use");return t.length===0?null:{role:"user",content:await Promise.all(t.map(async r=>{const a=s.tools.find(i=>("name"in i?i.name:i.mcp_server_name)===r.name);if(!a||!("run"in a))return{type:"tool_result",tool_use_id:r.id,content:`Error: Tool '${r.name}' not found`,is_error:!0};try{let i=r.input;"parse"in a&&a.parse&&(i=a.parse(i));const o=await a.run(i);return{type:"tool_result",tool_use_id:r.id,content:o}}catch(i){return{type:"tool_result",tool_use_id:r.id,content:`Error: ${i instanceof Error?i.message:String(i)}`,is_error:!0}}}))}}class Wn{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new Dt;for await(const t of this.iterator)for(const n of e.decode(t))yield JSON.parse(n);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new $("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new $("Attempted to iterate over a response with no body");return new Wn(Hs(e.body),t)}}let mi=class extends he{create(e,t){const{betas:n,...r}=e;return this._client.post("/v1/messages/batches?beta=true",{body:r,...t,headers:O([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}retrieve(e,t={},n){const{betas:r}=t??{};return this._client.get(G`/v1/messages/batches/${e}?beta=true`,{...n,headers:O([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},n==null?void 0:n.headers])})}list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",Ut,{query:r,...t,headers:O([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}delete(e,t={},n){const{betas:r}=t??{};return this._client.delete(G`/v1/messages/batches/${e}?beta=true`,{...n,headers:O([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},n==null?void 0:n.headers])})}cancel(e,t={},n){const{betas:r}=t??{};return this._client.post(G`/v1/messages/batches/${e}/cancel?beta=true`,{...n,headers:O([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},n==null?void 0:n.headers])})}async results(e,t={},n){const r=await this.retrieve(e);if(!r.results_url)throw new $(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);const{betas:a}=t??{};return this._client.get(r.results_url,{...n,headers:O([{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},n==null?void 0:n.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((i,o)=>Wn.fromResponse(o.response,o.controller))}};const Ur={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};let Hn=class extends he{constructor(){super(...arguments),this.batches=new mi(this._client)}create(e,t){const{betas:n,...r}=e;r.model in Ur&&console.warn(`The model '${r.model}' is deprecated and will reach end-of-life on ${Ur[r.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let a=this._client._options.timeout;if(!r.stream&&a==null){const i=ui[r.model]??void 0;a=this._client.calculateNonstreamingTimeout(r.max_tokens,i)}return this._client.post("/v1/messages?beta=true",{body:r,timeout:a??6e5,...t,headers:O([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:O([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t==null?void 0:t.headers])},this.create(e,t).then(n=>hi(n,e,{logger:this._client.logger??console}))}stream(e,t){return Cn.createMessage(this,e,t)}countTokens(e,t){const{betas:n,...r}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:r,...t,headers:O([{"anthropic-beta":[...n??[],"token-counting-2024-11-01"].toString()},t==null?void 0:t.headers])})}toolRunner(e,t){return new fi(this._client,e,t)}};Hn.Batches=mi;Hn.BetaToolRunner=fi;class gi extends he{create(e,t={},n){const{betas:r,...a}=t??{};return this._client.post(G`/v1/skills/${e}/versions?beta=true`,Gs({body:a,...n,headers:O([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},n==null?void 0:n.headers])},this._client))}retrieve(e,t,n){const{skill_id:r,betas:a}=t;return this._client.get(G`/v1/skills/${r}/versions/${e}?beta=true`,{...n,headers:O([{"anthropic-beta":[...a??[],"skills-2025-10-02"].toString()},n==null?void 0:n.headers])})}list(e,t={},n){const{betas:r,...a}=t??{};return this._client.getAPIList(G`/v1/skills/${e}/versions?beta=true`,ni,{query:a,...n,headers:O([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},n==null?void 0:n.headers])})}delete(e,t,n){const{skill_id:r,betas:a}=t;return this._client.delete(G`/v1/skills/${r}/versions/${e}?beta=true`,{...n,headers:O([{"anthropic-beta":[...a??[],"skills-2025-10-02"].toString()},n==null?void 0:n.headers])})}}class Xs extends he{constructor(){super(...arguments),this.versions=new gi(this._client)}create(e={},t){const{betas:n,...r}=e??{};return this._client.post("/v1/skills?beta=true",Gs({body:r,...t,headers:O([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},t==null?void 0:t.headers])},this._client))}retrieve(e,t={},n){const{betas:r}=t??{};return this._client.get(G`/v1/skills/${e}?beta=true`,{...n,headers:O([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},n==null?void 0:n.headers])})}list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/skills?beta=true",ni,{query:r,...t,headers:O([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},t==null?void 0:t.headers])})}delete(e,t={},n){const{betas:r}=t??{};return this._client.delete(G`/v1/skills/${e}?beta=true`,{...n,headers:O([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},n==null?void 0:n.headers])})}}Xs.Versions=gi;let Ze=class extends he{constructor(){super(...arguments),this.models=new li(this._client),this.messages=new Hn(this._client),this.files=new ci(this._client),this.skills=new Xs(this._client)}};Ze.Models=li;Ze.Messages=Hn;Ze.Files=ci;Ze.Skills=Xs;let pi=class extends he{create(e,t){const{betas:n,...r}=e;return this._client.post("/v1/complete",{body:r,timeout:this._client._options.timeout??6e5,...t,headers:O([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}};var oe,Ae,dt,tn,ft,mt,nn,gt,pe,pt,sn,rn,Ce,an,on,os,jr,cs,ls,us,hs,qr;const Wr="__json_buf";function Hr(s){return s.type==="tool_use"||s.type==="server_tool_use"}class In{constructor(){oe.add(this),this.messages=[],this.receivedMessages=[],Ae.set(this,void 0),this.controller=new AbortController,dt.set(this,void 0),tn.set(this,()=>{}),ft.set(this,()=>{}),mt.set(this,void 0),nn.set(this,()=>{}),gt.set(this,()=>{}),pe.set(this,{}),pt.set(this,!1),sn.set(this,!1),rn.set(this,!1),Ce.set(this,!1),an.set(this,void 0),on.set(this,void 0),cs.set(this,e=>{if(w(this,sn,!0),Pt(e)&&(e=new ue),e instanceof ue)return w(this,rn,!0),this._emit("abort",e);if(e instanceof $)return this._emit("error",e);if(e instanceof Error){const t=new $(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new $(String(e)))}),w(this,dt,new Promise((e,t)=>{w(this,tn,e,"f"),w(this,ft,t,"f")})),w(this,mt,new Promise((e,t)=>{w(this,nn,e,"f"),w(this,gt,t,"f")})),d(this,dt,"f").catch(()=>{}),d(this,mt,"f").catch(()=>{})}get response(){return d(this,an,"f")}get request_id(){return d(this,on,"f")}async withResponse(){w(this,Ce,!0);const e=await d(this,dt,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new In;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,n){const r=new In;for(const a of t.messages)r._addMessageParam(a);return r._run(()=>r._createMessage(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},d(this,cs,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,n){var i;const r=n==null?void 0:n.signal;let a;r&&(r.aborted&&this.controller.abort(),a=this.controller.abort.bind(this.controller),r.addEventListener("abort",a));try{d(this,oe,"m",ls).call(this);const{response:o,data:c}=await e.create({...t,stream:!0},{...n,signal:this.controller.signal}).withResponse();this._connected(o);for await(const l of c)d(this,oe,"m",us).call(this,l);if((i=c.controller.signal)!=null&&i.aborted)throw new ue;d(this,oe,"m",hs).call(this)}finally{r&&a&&r.removeEventListener("abort",a)}}_connected(e){this.ended||(w(this,an,e),w(this,on,e==null?void 0:e.headers.get("request-id")),d(this,tn,"f").call(this,e),this._emit("connect"))}get ended(){return d(this,pt,"f")}get errored(){return d(this,sn,"f")}get aborted(){return d(this,rn,"f")}abort(){this.controller.abort()}on(e,t){return(d(this,pe,"f")[e]||(d(this,pe,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=d(this,pe,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(d(this,pe,"f")[e]||(d(this,pe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{w(this,Ce,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){w(this,Ce,!0),await d(this,mt,"f")}get currentMessage(){return d(this,Ae,"f")}async finalMessage(){return await this.done(),d(this,oe,"m",os).call(this)}async finalText(){return await this.done(),d(this,oe,"m",jr).call(this)}_emit(e,...t){if(d(this,pt,"f"))return;e==="end"&&(w(this,pt,!0),d(this,nn,"f").call(this));const n=d(this,pe,"f")[e];if(n&&(d(this,pe,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!d(this,Ce,"f")&&!(n!=null&&n.length)&&Promise.reject(r),d(this,ft,"f").call(this,r),d(this,gt,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!d(this,Ce,"f")&&!(n!=null&&n.length)&&Promise.reject(r),d(this,ft,"f").call(this,r),d(this,gt,"f").call(this,r),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",d(this,oe,"m",os).call(this))}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;let r;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{d(this,oe,"m",ls).call(this),this._connected(null);const i=Nt.fromReadableStream(e,this.controller);for await(const o of i)d(this,oe,"m",us).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new ue;d(this,oe,"m",hs).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}[(Ae=new WeakMap,dt=new WeakMap,tn=new WeakMap,ft=new WeakMap,mt=new WeakMap,nn=new WeakMap,gt=new WeakMap,pe=new WeakMap,pt=new WeakMap,sn=new WeakMap,rn=new WeakMap,Ce=new WeakMap,an=new WeakMap,on=new WeakMap,cs=new WeakMap,oe=new WeakSet,os=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},jr=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(n=>n.type==="text").map(n=>n.text);if(t.length===0)throw new $("stream ended without producing a content block with type=text");return t.join(" ")},ls=function(){this.ended||w(this,Ae,void 0)},us=function(t){if(this.ended)return;const n=d(this,oe,"m",qr).call(this,t);switch(this._emit("streamEvent",t,n),t.type){case"content_block_delta":{const r=n.content.at(-1);switch(t.delta.type){case"text_delta":{r.type==="text"&&this._emit("text",t.delta.text,r.text||"");break}case"citations_delta":{r.type==="text"&&this._emit("citation",t.delta.citation,r.citations??[]);break}case"input_json_delta":{Hr(r)&&r.input&&this._emit("inputJson",t.delta.partial_json,r.input);break}case"thinking_delta":{r.type==="thinking"&&this._emit("thinking",t.delta.thinking,r.thinking);break}case"signature_delta":{r.type==="thinking"&&this._emit("signature",r.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(n),this._addMessage(n,!0);break}case"content_block_stop":{this._emit("contentBlock",n.content.at(-1));break}case"message_start":{w(this,Ae,n);break}}},hs=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");const t=d(this,Ae,"f");if(!t)throw new $("request ended without sending any chunks");return w(this,Ae,void 0),t},qr=function(t){let n=d(this,Ae,"f");if(t.type==="message_start"){if(n)throw new $(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!n)throw new $(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return n;case"message_delta":return n.stop_reason=t.delta.stop_reason,n.stop_sequence=t.delta.stop_sequence,n.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(n.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(n.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(n.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(n.usage.server_tool_use=t.usage.server_tool_use),n;case"content_block_start":return n.content.push({...t.content_block}),n;case"content_block_delta":{const r=n.content.at(t.index);switch(t.delta.type){case"text_delta":{(r==null?void 0:r.type)==="text"&&(n.content[t.index]={...r,text:(r.text||"")+t.delta.text});break}case"citations_delta":{(r==null?void 0:r.type)==="text"&&(n.content[t.index]={...r,citations:[...r.citations??[],t.delta.citation]});break}case"input_json_delta":{if(r&&Hr(r)){let a=r[Wr]||"";a+=t.delta.partial_json;const i={...r};Object.defineProperty(i,Wr,{value:a,enumerable:!1,writable:!0}),a&&(i.input=di(a)),n.content[t.index]=i}break}case"thinking_delta":{(r==null?void 0:r.type)==="thinking"&&(n.content[t.index]={...r,thinking:r.thinking+t.delta.thinking});break}case"signature_delta":{(r==null?void 0:r.type)==="thinking"&&(n.content[t.index]={...r,signature:t.delta.signature});break}default:t.delta}return n}case"content_block_stop":return n}},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("streamEvent",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Nt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let _i=class extends he{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(G`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",Ut,{query:e,...t})}delete(e,t){return this._client.delete(G`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(G`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const n=await this.retrieve(e);if(!n.results_url)throw new $(`No batch \`results_url\`; Has it finished processing? ${n.processing_status} - ${n.id}`);return this._client.get(n.results_url,{...t,headers:O([{Accept:"application/binary"},t==null?void 0:t.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((r,a)=>Wn.fromResponse(a.response,a.controller))}},Ks=class extends he{constructor(){super(...arguments),this.batches=new _i(this._client)}create(e,t){e.model in Jr&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Jr[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!e.stream&&n==null){const r=ui[e.model]??void 0;n=this._client.calculateNonstreamingTimeout(e.max_tokens,r)}return this._client.post("/v1/messages",{body:e,timeout:n??6e5,...t,stream:e.stream??!1})}stream(e,t){return In.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}};const Jr={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};Ks.Batches=_i;let yi=class extends he{retrieve(e,t={},n){const{betas:r}=t??{};return this._client.get(G`/v1/models/${e}`,{...n,headers:O([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},n==null?void 0:n.headers])})}list(e={},t){const{betas:n,...r}=e??{};return this._client.getAPIList("/v1/models",Ut,{query:r,...t,headers:O([{...(n==null?void 0:n.toString())!=null?{"anthropic-beta":n==null?void 0:n.toString()}:void 0},t==null?void 0:t.headers])})}};var ds={};const cn=s=>{var e,t,n,r;if(typeof globalThis.process<"u")return((e=ds==null?void 0:ds[s])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(r=(n=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,s))==null?void 0:r.trim()};var Cs,Vs,_n,wi;const Xc="\\n\\nHuman:",Kc="\\n\\nAssistant:";class D{constructor({baseURL:e=cn("ANTHROPIC_BASE_URL"),apiKey:t=cn("ANTHROPIC_API_KEY")??null,authToken:n=cn("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){Cs.add(this),_n.set(this,void 0);const a={apiKey:t,authToken:n,...r,baseURL:e||"https://api.anthropic.com"};if(!a.dangerouslyAllowBrowser&&mc())throw new $(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=a.baseURL,this.timeout=a.timeout??Vs.DEFAULT_TIMEOUT,this.logger=a.logger??console;const i="warn";this.logLevel=i,this.logLevel=Cr(a.logLevel,"ClientOptions.logLevel",this)??Cr(cn("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??i,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??wc(),w(this,_n,Sc),this._options=a,this.apiKey=typeof t=="string"?t:null,this.authToken=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization"))&&!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return O([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(this.apiKey!=null)return O([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(this.authToken!=null)return O([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new $(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Ge}`}defaultIdempotencyKey(){return`stainless-node-retry-${Fa()}`}makeStatusError(e,t,n,r){return ae.generate(e,t,n,r)}buildURL(e,t,n){const r=!d(this,Cs,"m",wi).call(this)&&n||this.baseURL,a=lc(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return uc(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new $("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new Za(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var M,E;const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:i,url:o,timeout:c}=await this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(i,{url:o,options:r});const l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,f=Date.now();if(Y(this).debug(`[${l}] sending request`,Ie({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:i.headers})),(M=r.signal)!=null&&M.aborted)throw new ue;const g=new AbortController,u=await this.fetchWithTimeout(o,i,c,g).catch(As),_=Date.now();if(u instanceof globalThis.Error){const v=`retrying, ${t} attempts remaining`;if((E=r.signal)!=null&&E.aborted)throw new ue;const S=Pt(u)||/timed? ?out/i.test(String(u)+("cause"in u?String(u.cause):""));if(t)return Y(this).info(`[${l}] connection ${S?"timed out":"failed"} - ${v}`),Y(this).debug(`[${l}] connection ${S?"timed out":"failed"} (${v})`,Ie({retryOfRequestLogID:n,url:o,durationMs:_-f,message:u.message})),this.retryRequest(r,t,n??l);throw Y(this).info(`[${l}] connection ${S?"timed out":"failed"} - error; no more retries left`),Y(this).debug(`[${l}] connection ${S?"timed out":"failed"} (error; no more retries left)`,Ie({retryOfRequestLogID:n,url:o,durationMs:_-f,message:u.message})),S?new Da:new qn({cause:u})}const y=[...u.headers.entries()].filter(([v])=>v==="request-id").map(([v,S])=>", "+v+": "+JSON.stringify(S)).join(""),R=`[${l}${m}${y}] ${i.method} ${o} ${u.ok?"succeeded":"failed"} with status ${u.status} in ${_-f}ms`;if(!u.ok){const v=await this.shouldRetry(u);if(t&&v){const T=`retrying, ${t} attempts remaining`;return await bc(u.body),Y(this).info(`${R} - ${T}`),Y(this).debug(`[${l}] response error (${T})`,Ie({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,durationMs:_-f})),this.retryRequest(r,t,n??l,u.headers)}const S=v?"error; no more retries left":"error; not retryable";Y(this).info(`${R} - ${S}`);const L=await u.text().catch(T=>As(T).message),P=Ka(L),I=P?void 0:L;throw Y(this).debug(`[${l}] response error (${S})`,Ie({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,message:I,durationMs:Date.now()-f})),this.makeStatusError(u.status,P,I,u.headers)}return Y(this).info(R),Y(this).debug(`[${l}] response start`,Ie({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,durationMs:_-f})),{response:u,options:r,controller:g,requestLogID:l,retryOfRequestLogID:n,startTime:f}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new Ic(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:i,...o}=t||{};a&&a.addEventListener("abort",()=>r.abort());const c=setTimeout(()=>r.abort(),n),l=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,m={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...o};i&&(m.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,m)}finally{clearTimeout(c)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let a;const i=r==null?void 0:r.get("retry-after-ms");if(i){const c=parseFloat(i);Number.isNaN(c)||(a=c)}const o=r==null?void 0:r.get("retry-after");if(o&&!a){const c=parseFloat(o);Number.isNaN(c)?a=Date.parse(o)-Date.now():a=c*1e3}if(!(a&&0<=a&&a<60*1e3)){const c=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,c)}return await fc(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new $("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:a,query:i,defaultBaseURL:o}=n,c=this.buildURL(a,i,o);"timeout"in n&&dc("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:l,body:m}=this.buildBody({options:n}),f=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:f,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"},...m&&{body:m},...this.fetchOptions??{},...n.fetchOptions??{}},url:c,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const i=O([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...yc(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=O([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Ya(e)}:d(this,_n,"f").call(this,{body:e,headers:n})}}Vs=D,_n=new WeakMap,Cs=new WeakSet,wi=function(){return this.baseURL!=="https://api.anthropic.com"};D.Anthropic=Vs;D.HUMAN_PROMPT=Xc;D.AI_PROMPT=Kc;D.DEFAULT_TIMEOUT=6e5;D.AnthropicError=$;D.APIError=ae;D.APIConnectionError=qn;D.APIConnectionTimeoutError=Da;D.APIUserAbortError=ue;D.NotFoundError=Wa;D.ConflictError=Ha;D.RateLimitError=Ga;D.BadRequestError=Ua;D.AuthenticationError=ja;D.InternalServerError=Xa;D.PermissionDeniedError=qa;D.UnprocessableEntityError=Ja;D.toFile=Lc;class jt extends D{constructor(){super(...arguments),this.completions=new pi(this),this.messages=new Ks(this),this.models=new yi(this),this.beta=new Ze(this)}}jt.Completions=pi;jt.Messages=Ks;jt.Models=yi;jt.Beta=Ze;function k(s,e,t,n,r){if(typeof e=="function"?s!==e||!0:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(s,t),t}function h(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)}let bi=function(){const{crypto:s}=globalThis;if(s!=null&&s.randomUUID)return bi=s.randomUUID.bind(s),s.randomUUID();const e=new Uint8Array(1),t=s?()=>s.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function Is(s){return typeof s=="object"&&s!==null&&("name"in s&&s.name==="AbortError"||"message"in s&&String(s.message).includes("FetchRequestCanceledException"))}const Os=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null){try{if(Object.prototype.toString.call(s)==="[object Error]"){const e=new Error(s.message,s.cause?{cause:s.cause}:{});return s.stack&&(e.stack=s.stack),s.cause&&!e.cause&&(e.cause=s.cause),s.name&&(e.name=s.name),e}}catch{}try{return new Error(JSON.stringify(s))}catch{}}return new Error(s)};class x extends Error{}class X extends x{constructor(e,t,n,r){super(`${X.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.requestID=r==null?void 0:r.get("x-request-id"),this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new Jn({message:n,cause:Os(t)});const a=t==null?void 0:t.error;return e===400?new Si(e,a,n,r):e===401?new Ai(e,a,n,r):e===403?new xi(e,a,n,r):e===404?new Ri(e,a,n,r):e===409?new Ei(e,a,n,r):e===422?new vi(e,a,n,r):e===429?new ki(e,a,n,r):e>=500?new $i(e,a,n,r):new X(e,a,n,r)}}class ce extends X{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Jn extends X{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Ys extends Jn{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Si extends X{}class Ai extends X{}class xi extends X{}class Ri extends X{}class Ei extends X{}class vi extends X{}class ki extends X{}class $i extends X{}class Ci extends x{constructor(){super("Could not parse response content as the length limit was reached")}}class Ii extends x{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class St extends Error{constructor(e){super(e)}}const Vc=/^[a-z][a-z0-9+.-]*:/i,Yc=s=>Vc.test(s);let Q=s=>(Q=Array.isArray,Q(s)),Gr=Q;function Oi(s){return typeof s!="object"?{}:s??{}}function zc(s){if(!s)return!0;for(const e in s)return!1;return!0}function Qc(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function fs(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}const Zc=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new x(`${s} must be an integer`);if(e<0)throw new x(`${s} must be a positive integer`);return e},el=s=>{try{return JSON.parse(s)}catch{return}},qt=s=>new Promise(e=>setTimeout(e,s)),Ke="6.15.0",tl=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function nl(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const sl=()=>{var t;const s=nl();if(s==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ke,"X-Stainless-OS":Kr(Deno.build.os),"X-Stainless-Arch":Xr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ke,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(s==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ke,"X-Stainless-OS":Kr(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Xr(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=rl();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ke,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ke,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function rl(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${r}.${a}.${i}`}}}return null}const Xr=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Kr=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let Vr;const al=()=>Vr??(Vr=sl());function il(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Ti(...s){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...s)}function Mi(s){let e=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s[Symbol.iterator]();return Ti({start(){},async pull(t){const{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function Pi(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function ol(s){var n,r;if(s===null||typeof s!="object")return;if(s[Symbol.asyncIterator]){await((r=(n=s[Symbol.asyncIterator]()).return)==null?void 0:r.call(n));return}const e=s.getReader(),t=e.cancel();e.releaseLock(),await t}const cl=({headers:s,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),Ni="RFC3986",Li=s=>String(s),Yr={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:Li},ll="RFC1738";let Ts=(s,e)=>(Ts=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Ts(s,e));const de=(()=>{const s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})(),ms=1024,ul=(s,e,t,n,r)=>{if(s.length===0)return s;let a=s;if(typeof s=="symbol"?a=Symbol.prototype.toString.call(s):typeof s!="string"&&(a=String(s)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=ms){const c=a.length>=ms?a.slice(o,o+ms):a,l=[];for(let m=0;m<c.length;++m){let f=c.charCodeAt(m);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||r===ll&&(f===40||f===41)){l[l.length]=c.charAt(m);continue}if(f<128){l[l.length]=de[f];continue}if(f<2048){l[l.length]=de[192|f>>6]+de[128|f&63];continue}if(f<55296||f>=57344){l[l.length]=de[224|f>>12]+de[128|f>>6&63]+de[128|f&63];continue}m+=1,f=65536+((f&1023)<<10|c.charCodeAt(m)&1023),l[l.length]=de[240|f>>18]+de[128|f>>12&63]+de[128|f>>6&63]+de[128|f&63]}i+=l.join("")}return i};function hl(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function zr(s,e){if(Q(s)){const t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}const Bi={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},Fi=function(s,e){Array.prototype.push.apply(s,Q(e)?e:[e])};let Qr;const q={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:ul,encodeValuesOnly:!1,format:Ni,formatter:Li,indices:!1,serializeDate(s){return(Qr??(Qr=Function.prototype.call.bind(Date.prototype.toISOString)))(s)},skipNulls:!1,strictNullHandling:!1};function dl(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}const gs={};function Di(s,e,t,n,r,a,i,o,c,l,m,f,g,u,_,y,R,M){let E=s,v=M,S=0,L=!1;for(;(v=v.get(gs))!==void 0&&!L;){const B=v.get(s);if(S+=1,typeof B<"u"){if(B===S)throw new RangeError("Cyclic object value");L=!0}typeof v.get(gs)>"u"&&(S=0)}if(typeof l=="function"?E=l(e,E):E instanceof Date?E=g==null?void 0:g(E):t==="comma"&&Q(E)&&(E=zr(E,function(B){return B instanceof Date?g==null?void 0:g(B):B})),E===null){if(a)return c&&!y?c(e,q.encoder,R,"key",u):e;E=""}if(dl(E)||hl(E)){if(c){const B=y?e:c(e,q.encoder,R,"key",u);return[(_==null?void 0:_(B))+"="+(_==null?void 0:_(c(E,q.encoder,R,"value",u)))]}return[(_==null?void 0:_(e))+"="+(_==null?void 0:_(String(E)))]}const P=[];if(typeof E>"u")return P;let I;if(t==="comma"&&Q(E))y&&c&&(E=zr(E,c)),I=[{value:E.length>0?E.join(",")||null:void 0}];else if(Q(l))I=l;else{const B=Object.keys(E);I=m?B.sort(m):B}const z=o?String(e).replace(/\./g,"%2E"):String(e),T=n&&Q(E)&&E.length===1?z+"[]":z;if(r&&Q(E)&&E.length===0)return T+"[]";for(let B=0;B<I.length;++B){const N=I[B],De=typeof N=="object"&&typeof N.value<"u"?N.value:E[N];if(i&&De===null)continue;const ns=f&&o?N.replace(/\./g,"%2E"):N,oc=Q(E)?typeof t=="function"?t(T,ns):T:T+(f?"."+ns:"["+ns+"]");M.set(s,S);const Sr=new WeakMap;Sr.set(gs,M),Fi(P,Di(De,oc,t,n,r,a,i,o,t==="comma"&&y&&Q(E)?null:c,l,m,f,g,u,_,y,R,Sr))}return P}function fl(s=q){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=s.charset||q.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Ni;if(typeof s.format<"u"){if(!Ts(Yr,s.format))throw new TypeError("Unknown format option provided.");t=s.format}const n=Yr[t];let r=q.filter;(typeof s.filter=="function"||Q(s.filter))&&(r=s.filter);let a;if(s.arrayFormat&&s.arrayFormat in Bi?a=s.arrayFormat:"indices"in s?a=s.indices?"indices":"repeat":a=q.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:q.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:q.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:q.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:q.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?q.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:q.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:q.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:q.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:q.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:q.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:q.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:q.strictNullHandling}}function ml(s,e={}){let t=s;const n=fl(e);let r,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):Q(n.filter)&&(a=n.filter,r=a);const i=[];if(typeof t!="object"||t===null)return"";const o=Bi[n.arrayFormat],c=o==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const l=new WeakMap;for(let g=0;g<r.length;++g){const u=r[g];n.skipNulls&&t[u]===null||Fi(i,Di(t[u],u,o,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}const m=i.join(n.delimiter);let f=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),m.length>0?f+m:""}function gl(s){let e=0;for(const r of s)e+=r.length;const t=new Uint8Array(e);let n=0;for(const r of s)t.set(r,n),n+=r.length;return t}let Zr;function zs(s){let e;return(Zr??(e=new globalThis.TextEncoder,Zr=e.encode.bind(e)))(s)}let ea;function ta(s){let e;return(ea??(e=new globalThis.TextDecoder,ea=e.decode.bind(e)))(s)}var ne,se;class Gn{constructor(){ne.set(this,void 0),se.set(this,void 0),k(this,ne,new Uint8Array),k(this,se,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?zs(e):e;k(this,ne,gl([h(this,ne,"f"),t]));const n=[];let r;for(;(r=pl(h(this,ne,"f"),h(this,se,"f")))!=null;){if(r.carriage&&h(this,se,"f")==null){k(this,se,r.index);continue}if(h(this,se,"f")!=null&&(r.index!==h(this,se,"f")+1||r.carriage)){n.push(ta(h(this,ne,"f").subarray(0,h(this,se,"f")-1))),k(this,ne,h(this,ne,"f").subarray(h(this,se,"f"))),k(this,se,null);continue}const a=h(this,se,"f")!==null?r.preceding-1:r.preceding,i=ta(h(this,ne,"f").subarray(0,a));n.push(i),k(this,ne,h(this,ne,"f").subarray(r.index)),k(this,se,null)}return n}flush(){return h(this,ne,"f").length?this.decode(`
`):[]}}ne=new WeakMap,se=new WeakMap;Gn.NEWLINE_CHARS=new Set([`
`,"\r"]);Gn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function pl(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function _l(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}const On={off:0,error:200,warn:300,info:400,debug:500},na=(s,e,t)=>{if(s){if(Qc(On,s))return s;H(t).warn(`${e} was set to ${JSON.stringify(s)}, expected one of ${JSON.stringify(Object.keys(On))}`)}};function At(){}function ln(s,e,t){return!e||On[s]>On[t]?At:e[s].bind(e)}const yl={error:At,warn:At,info:At,debug:At};let sa=new WeakMap;function H(s){const e=s.logger,t=s.logLevel??"off";if(!e)return yl;const n=sa.get(e);if(n&&n[0]===t)return n[1];const r={error:ln("error",e,t),warn:ln("warn",e,t),info:ln("info",e,t),debug:ln("debug",e,t)};return sa.set(e,[t,r]),r}const Oe=s=>(s.options&&(s.options={...s.options},delete s.options.headers),s.headers&&(s.headers=Object.fromEntries((s.headers instanceof Headers?[...s.headers]:Object.entries(s.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in s&&(s.retryOfRequestLogID&&(s.retryOf=s.retryOfRequestLogID),delete s.retryOfRequestLogID),s);var _t;class me{constructor(e,t,n){this.iterator=e,_t.set(this,void 0),this.controller=t,k(this,_t,n)}static fromSSEResponse(e,t,n){let r=!1;const a=n?H(n):console;async function*i(){if(r)throw new x("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const c of wl(e,t))if(!o){if(c.data.startsWith("[DONE]")){o=!0;continue}if(c.event===null||!c.event.startsWith("thread.")){let l;try{l=JSON.parse(c.data)}catch(m){throw a.error("Could not parse message into JSON:",c.data),a.error("From chunk:",c.raw),m}if(l&&l.error)throw new X(void 0,l.error,void 0,e.headers);yield l}else{let l;try{l=JSON.parse(c.data)}catch(m){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),m}if(c.event=="error")throw new X(void 0,l.error,l.message,void 0);yield{event:c.event,data:l}}}o=!0}catch(c){if(Is(c))return;throw c}finally{o||t.abort()}}return new me(i,t,n)}static fromReadableStream(e,t,n){let r=!1;async function*a(){const o=new Gn,c=Pi(e);for await(const l of c)for(const m of o.decode(l))yield m;for(const l of o.flush())yield l}async function*i(){if(r)throw new x("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const c of a())o||c&&(yield JSON.parse(c));o=!0}catch(c){if(Is(c))return;throw c}finally{o||t.abort()}}return new me(i,t,n)}[(_t=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new me(()=>r(e),this.controller,h(this,_t,"f")),new me(()=>r(t),this.controller,h(this,_t,"f"))]}toReadableStream(){const e=this;let t;return Ti({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:r,done:a}=await t.next();if(a)return n.close();const i=zs(JSON.stringify(r)+`
`);n.enqueue(i)}catch(r){n.error(r)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}}async function*wl(s,e){if(!s.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new x("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new x("Attempted to iterate over a response with no body");const t=new Sl,n=new Gn,r=Pi(s.body);for await(const a of bl(r))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*bl(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?zs(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=_l(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class Sl{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=Al(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function Al(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}async function Ui(s,e){const{response:t,requestLogID:n,retryOfRequestLogID:r,startTime:a}=e,i=await(async()=>{var f;if(e.options.stream)return H(s).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,s):me.fromSSEResponse(t,e.controller,s);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),c=(f=o==null?void 0:o.split(";")[0])==null?void 0:f.trim();if((c==null?void 0:c.includes("application/json"))||(c==null?void 0:c.endsWith("+json"))){const g=await t.json();return ji(g,t)}return await t.text()})();return H(s).debug(`[${n}] response parsed`,Oe({retryOfRequestLogID:r,url:t.url,status:t.status,body:i,durationMs:Date.now()-a})),i}function ji(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var xt;class Xn extends Promise{constructor(e,t,n=Ui){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n,xt.set(this,void 0),k(this,xt,e)}_thenUnwrap(e){return new Xn(h(this,xt,"f"),this.responsePromise,async(t,n)=>ji(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(h(this,xt,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}xt=new WeakMap;var un;class Qs{constructor(e,t,n,r){un.set(this,void 0),k(this,un,e),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new x("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await h(this,un,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(un=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class xl extends Xn{constructor(e,t,n){super(e,t,async(r,a)=>new n(r,a.response,await Ui(r,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Kn extends Qs{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class F extends Qs{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var n;const e=this.getPaginatedItems(),t=(n=e[e.length-1])==null?void 0:n.id;return t?{...this.options,query:{...Oi(this.options.query),after:t}}:null}}class Tn extends Qs{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?{...this.options,query:{...Oi(this.options.query),after:e}}:null}}const qi=()=>{var s;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((s=e==null?void 0:e.versions)==null?void 0:s.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function It(s,e,t){return qi(),new File(s,e??"unknown_file",t)}function yn(s){return(typeof s=="object"&&s!==null&&("name"in s&&s.name&&String(s.name)||"url"in s&&s.url&&String(s.url)||"filename"in s&&s.filename&&String(s.filename)||"path"in s&&s.path&&String(s.path))||"").split(/[\\/]/).pop()||void 0}const Zs=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",ra=async(s,e)=>Ms(s.body)?{...s,body:await Wi(s.body,e)}:s,Ne=async(s,e)=>({...s,body:await Wi(s.body,e)}),aa=new WeakMap;function Rl(s){const e=typeof s=="function"?s:s.fetch,t=aa.get(e);if(t)return t;const n=(async()=>{try{const r="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new r(a).text()}catch{return!0}})();return aa.set(e,n),n}const Wi=async(s,e)=>{if(!await Rl(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(s||{}).map(([n,r])=>Ps(t,n,r))),t},Hi=s=>s instanceof Blob&&"name"in s,El=s=>typeof s=="object"&&s!==null&&(s instanceof Response||Zs(s)||Hi(s)),Ms=s=>{if(El(s))return!0;if(Array.isArray(s))return s.some(Ms);if(s&&typeof s=="object"){for(const e in s)if(Ms(s[e]))return!0}return!1},Ps=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(t instanceof Response)s.append(e,It([await t.blob()],yn(t)));else if(Zs(t))s.append(e,It([await new Response(Mi(t)).blob()],yn(t)));else if(Hi(t))s.append(e,t,yn(t));else if(Array.isArray(t))await Promise.all(t.map(n=>Ps(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>Ps(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},Ji=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",vl=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&Ji(s),kl=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function";async function $l(s,e,t){if(qi(),s=await s,vl(s))return s instanceof File?s:It([await s.arrayBuffer()],s.name);if(kl(s)){const r=await s.blob();return e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()),It(await Ns(r),e,t)}const n=await Ns(s);if(e||(e=yn(s)),!(t!=null&&t.type)){const r=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof r=="string"&&(t={...t,type:r})}return It(n,e,t)}async function Ns(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(Ji(s))e.push(s instanceof Blob?s:await s.arrayBuffer());else if(Zs(s))for await(const n of s)e.push(...await Ns(n));else{const n=(t=s==null?void 0:s.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof s}${n?`; constructor: ${n}`:""}${Cl(s)}`)}return e}function Cl(s){return typeof s!="object"||s===null?"":`; props: [${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}class A{constructor(e){this._client=e}}function Gi(s){return s.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ia=Object.freeze(Object.create(null)),Il=(s=Gi)=>function(t,...n){if(t.length===1)return t[0];let r=!1;const a=[],i=t.reduce((m,f,g)=>{var y;/[?#]/.test(f)&&(r=!0);const u=n[g];let _=(r?encodeURIComponent:s)(""+u);return g!==n.length&&(u==null||typeof u=="object"&&u.toString===((y=Object.getPrototypeOf(Object.getPrototypeOf(u.hasOwnProperty??ia)??ia))==null?void 0:y.toString))&&(_=u+"",a.push({start:m.length+f.length,length:_.length,error:`Value of type ${Object.prototype.toString.call(u).slice(8,-1)} is not a valid path parameter`})),m+f+(g===n.length?"":_)},""),o=i.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let l;for(;(l=c.exec(o))!==null;)a.push({start:l.index,length:l[0].length,error:`Value "${l[0]}" can't be safely passed as a path parameter`});if(a.sort((m,f)=>m.start-f.start),a.length>0){let m=0;const f=a.reduce((g,u)=>{const _=" ".repeat(u.start-m),y="^".repeat(u.length);return m=u.start+u.length,g+_+y},"");throw new x(`Path parameters result in path with invalid segments:
${a.map(g=>g.error).join(`
`)}
${i}
${f}`)}return i},p=Il(Gi);let Xi=class extends A{list(e,t={},n){return this._client.getAPIList(p`/chat/completions/${e}/messages`,F,{query:t,...n})}};function Mn(s){return s!==void 0&&"function"in s&&s.function!==void 0}function er(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function Wt(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function Ol(s,e){return!e||!Ki(e)?{...s,choices:s.choices.map(t=>(Vi(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:tr(s,e)}function tr(s,e){const t=s.choices.map(n=>{var r;if(n.finish_reason==="length")throw new Ci;if(n.finish_reason==="content_filter")throw new Ii;return Vi(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((r=n.message.tool_calls)==null?void 0:r.map(a=>Ml(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Tl(e,n.message.content):null}}});return{...s,choices:t}}function Tl(s,e){var t,n;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=s.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function Ml(s,e){var n;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return Mn(r)&&((a=r.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Wt(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Pl(s,e){var n;if(!s||!("tools"in s)||!s.tools)return!1;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return Mn(r)&&((a=r.function)==null?void 0:a.name)===e.function.name});return Mn(t)&&(Wt(t)||(t==null?void 0:t.function.strict)||!1)}function Ki(s){var e;return er(s.response_format)?!0:((e=s.tools)==null?void 0:e.some(t=>Wt(t)||t.type==="function"&&t.function.strict===!0))??!1}function Vi(s){for(const e of s||[])if(e.type!=="function")throw new x(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function Nl(s){for(const e of s??[]){if(e.type!=="function")throw new x(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new x(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const Pn=s=>(s==null?void 0:s.role)==="assistant",Yi=s=>(s==null?void 0:s.role)==="tool";var Ls,wn,bn,Rt,Et,Sn,vt,ye,kt,Nn,Ln,Ve,zi;class nr{constructor(){Ls.add(this),this.controller=new AbortController,wn.set(this,void 0),bn.set(this,()=>{}),Rt.set(this,()=>{}),Et.set(this,void 0),Sn.set(this,()=>{}),vt.set(this,()=>{}),ye.set(this,{}),kt.set(this,!1),Nn.set(this,!1),Ln.set(this,!1),Ve.set(this,!1),k(this,wn,new Promise((e,t)=>{k(this,bn,e,"f"),k(this,Rt,t,"f")})),k(this,Et,new Promise((e,t)=>{k(this,Sn,e,"f"),k(this,vt,t,"f")})),h(this,wn,"f").catch(()=>{}),h(this,Et,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},h(this,Ls,"m",zi).bind(this))},0)}_connected(){this.ended||(h(this,bn,"f").call(this),this._emit("connect"))}get ended(){return h(this,kt,"f")}get errored(){return h(this,Nn,"f")}get aborted(){return h(this,Ln,"f")}abort(){this.controller.abort()}on(e,t){return(h(this,ye,"f")[e]||(h(this,ye,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=h(this,ye,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(h(this,ye,"f")[e]||(h(this,ye,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{k(this,Ve,!0),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){k(this,Ve,!0),await h(this,Et,"f")}_emit(e,...t){if(h(this,kt,"f"))return;e==="end"&&(k(this,kt,!0),h(this,Sn,"f").call(this));const n=h(this,ye,"f")[e];if(n&&(h(this,ye,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!h(this,Ve,"f")&&!(n!=null&&n.length)&&Promise.reject(r),h(this,Rt,"f").call(this,r),h(this,vt,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!h(this,Ve,"f")&&!(n!=null&&n.length)&&Promise.reject(r),h(this,Rt,"f").call(this,r),h(this,vt,"f").call(this,r),this._emit("end")}}_emitFinal(){}}wn=new WeakMap,bn=new WeakMap,Rt=new WeakMap,Et=new WeakMap,Sn=new WeakMap,vt=new WeakMap,ye=new WeakMap,kt=new WeakMap,Nn=new WeakMap,Ln=new WeakMap,Ve=new WeakMap,Ls=new WeakSet,zi=function(e){if(k(this,Nn,!0),e instanceof Error&&e.name==="AbortError"&&(e=new ce),e instanceof ce)return k(this,Ln,!0),this._emit("abort",e);if(e instanceof x)return this._emit("error",e);if(e instanceof Error){const t=new x(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new x(String(e)))};function Ll(s){return typeof s.parse=="function"}var V,Bs,Bn,Fs,Ds,Us,Qi,Zi;const Bl=10;class eo extends nr{constructor(){super(...arguments),V.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),Yi(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Pn(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new x("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),h(this,V,"m",Bs).call(this)}async finalMessage(){return await this.done(),h(this,V,"m",Bn).call(this)}async finalFunctionToolCall(){return await this.done(),h(this,V,"m",Fs).call(this)}async finalFunctionToolCallResult(){return await this.done(),h(this,V,"m",Ds).call(this)}async totalUsage(){return await this.done(),h(this,V,"m",Us).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=h(this,V,"m",Bn).call(this);t&&this._emit("finalMessage",t);const n=h(this,V,"m",Bs).call(this);n&&this._emit("finalContent",n);const r=h(this,V,"m",Fs).call(this);r&&this._emit("finalFunctionToolCall",r);const a=h(this,V,"m",Ds).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",h(this,V,"m",Us).call(this))}async _createChatCompletion(e,t,n){const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),h(this,V,"m",Qi).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(tr(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){var u,_,y;const r="tool",{tool_choice:a="auto",stream:i,...o}=t,c=typeof a!="string"&&a.type==="function"&&((u=a==null?void 0:a.function)==null?void 0:u.name),{maxChatCompletions:l=Bl}=n||{},m=t.tools.map(R=>{if(Wt(R)){if(!R.$callback)throw new x("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:R.$callback,name:R.function.name,description:R.function.description||"",parameters:R.function.parameters,parse:R.$parseRaw,strict:!0}}}return R}),f={};for(const R of m)R.type==="function"&&(f[R.function.name||R.function.function.name]=R.function);const g="tools"in t?m.map(R=>R.type==="function"?{type:"function",function:{name:R.function.name||R.function.function.name,parameters:R.function.parameters,description:R.function.description,strict:R.function.strict}}:R):void 0;for(const R of t.messages)this._addMessage(R,!1);for(let R=0;R<l;++R){const E=(_=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:g,messages:[...this.messages]},n)).choices[0])==null?void 0:_.message;if(!E)throw new x("missing message in ChatCompletion response");if(!((y=E.tool_calls)!=null&&y.length))return;for(const v of E.tool_calls){if(v.type!=="function")continue;const S=v.id,{name:L,arguments:P}=v.function,I=f[L];if(I){if(c&&c!==L){const N=`Invalid tool_call: ${JSON.stringify(L)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:r,tool_call_id:S,content:N});continue}}else{const N=`Invalid tool_call: ${JSON.stringify(L)}. Available options are: ${Object.keys(f).map(De=>JSON.stringify(De)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:S,content:N});continue}let z;try{z=Ll(I)?await I.parse(P):P}catch(N){const De=N instanceof Error?N.message:String(N);this._addMessage({role:r,tool_call_id:S,content:De});continue}const T=await I.function(z,this),B=h(this,V,"m",Zi).call(this,T);if(this._addMessage({role:r,tool_call_id:S,content:B}),c)return}}}}V=new WeakSet,Bs=function(){return h(this,V,"m",Bn).call(this).content??null},Bn=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Pn(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new x("stream ended without producing a ChatCompletionMessage with role=assistant")},Fs=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const r=this.messages[n];if(Pn(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.filter(a=>a.type==="function").at(-1))==null?void 0:t.function}},Ds=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Yi(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Us=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Qi=function(e){if(e.n!=null&&e.n>1)throw new x("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Zi=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class sr extends eo{static runTools(e,t,n){const r=new sr,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),Pn(e)&&e.content&&this._emit("content",e.content)}}const to=1,no=2,so=4,ro=8,ao=16,io=32,oo=64,co=128,lo=256,uo=co|lo,ho=ao|io|uo|oo,fo=to|no|ho,mo=so|ro,Fl=fo|mo,W={STR:to,NUM:no,ARR:so,OBJ:ro,NULL:ao,BOOL:io,NAN:oo,INFINITY:co,MINUS_INFINITY:lo,INF:uo,SPECIAL:ho,ATOM:fo,COLLECTION:mo,ALL:Fl};class Dl extends Error{}class Ul extends Error{}function jl(s,e=W.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return ql(s.trim(),e)}const ql=(s,e)=>{const t=s.length;let n=0;const r=g=>{throw new Dl(`${g} at position ${n}`)},a=g=>{throw new Ul(`${g} at position ${n}`)},i=()=>(f(),n>=t&&r("Unexpected end of input"),s[n]==='"'?o():s[n]==="{"?c():s[n]==="["?l():s.substring(n,n+4)==="null"||W.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||W.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||W.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||W.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||W.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||W.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):m()),o=()=>{const g=n;let u=!1;for(n++;n<t&&(s[n]!=='"'||u&&s[n-1]==="\\");)u=s[n]==="\\"?!u:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(g,++n-Number(u)))}catch(_){a(String(_))}else if(W.STR&e)try{return JSON.parse(s.substring(g,n-Number(u))+'"')}catch{return JSON.parse(s.substring(g,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},c=()=>{n++,f();const g={};try{for(;s[n]!=="}";){if(f(),n>=t&&W.OBJ&e)return g;const u=o();f(),n++;try{const _=i();Object.defineProperty(g,u,{value:_,writable:!0,enumerable:!0,configurable:!0})}catch(_){if(W.OBJ&e)return g;throw _}f(),s[n]===","&&n++}}catch{if(W.OBJ&e)return g;r("Expected '}' at end of object")}return n++,g},l=()=>{n++;const g=[];try{for(;s[n]!=="]";)g.push(i()),f(),s[n]===","&&n++}catch{if(W.ARR&e)return g;r("Expected ']' at end of array")}return n++,g},m=()=>{if(n===0){s==="-"&&W.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(u){if(W.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}a(String(u))}}const g=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(W.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(g,n))}catch{s.substring(g,n)==="-"&&W.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(g,s.lastIndexOf("e")))}catch(_){a(String(_))}}},f=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return i()},oa=s=>jl(s,W.ALL^W.NUM);var U,_e,qe,xe,ps,hn,_s,ys,ws,dn,bs,ca;class Lt extends eo{constructor(e){super(),U.add(this),_e.set(this,void 0),qe.set(this,void 0),xe.set(this,void 0),k(this,_e,e),k(this,qe,[])}get currentChatCompletionSnapshot(){return h(this,xe,"f")}static fromReadableStream(e){const t=new Lt(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new Lt(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),h(this,U,"m",ps).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)h(this,U,"m",_s).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new ce;return this._addChatCompletion(h(this,U,"m",dn).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),h(this,U,"m",ps).call(this),this._connected();const r=me.fromReadableStream(e,this.controller);let a;for await(const o of r)a&&a!==o.id&&this._addChatCompletion(h(this,U,"m",dn).call(this)),h(this,U,"m",_s).call(this,o),a=o.id;if((i=r.controller.signal)!=null&&i.aborted)throw new ce;return this._addChatCompletion(h(this,U,"m",dn).call(this))}[(_e=new WeakMap,qe=new WeakMap,xe=new WeakMap,U=new WeakSet,ps=function(){this.ended||k(this,xe,void 0)},hn=function(t){let n=h(this,qe,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},h(this,qe,"f")[t.index]=n,n)},_s=function(t){var r,a,i,o,c,l,m,f,g,u,_,y,R,M,E;if(this.ended)return;const n=h(this,U,"m",ca).call(this,t);this._emit("chunk",t,n);for(const v of t.choices){const S=n.choices[v.index];v.delta.content!=null&&((r=S.message)==null?void 0:r.role)==="assistant"&&((a=S.message)!=null&&a.content)&&(this._emit("content",v.delta.content,S.message.content),this._emit("content.delta",{delta:v.delta.content,snapshot:S.message.content,parsed:S.message.parsed})),v.delta.refusal!=null&&((i=S.message)==null?void 0:i.role)==="assistant"&&((o=S.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:v.delta.refusal,snapshot:S.message.refusal}),((c=v.logprobs)==null?void 0:c.content)!=null&&((l=S.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(m=v.logprobs)==null?void 0:m.content,snapshot:((f=S.logprobs)==null?void 0:f.content)??[]}),((g=v.logprobs)==null?void 0:g.refusal)!=null&&((u=S.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(_=v.logprobs)==null?void 0:_.refusal,snapshot:((y=S.logprobs)==null?void 0:y.refusal)??[]});const L=h(this,U,"m",hn).call(this,S);S.finish_reason&&(h(this,U,"m",ws).call(this,S),L.current_tool_call_index!=null&&h(this,U,"m",ys).call(this,S,L.current_tool_call_index));for(const P of v.delta.tool_calls??[])L.current_tool_call_index!==P.index&&(h(this,U,"m",ws).call(this,S),L.current_tool_call_index!=null&&h(this,U,"m",ys).call(this,S,L.current_tool_call_index)),L.current_tool_call_index=P.index;for(const P of v.delta.tool_calls??[]){const I=(R=S.message.tool_calls)==null?void 0:R[P.index];I!=null&&I.type&&((I==null?void 0:I.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(M=I.function)==null?void 0:M.name,index:P.index,arguments:I.function.arguments,parsed_arguments:I.function.parsed_arguments,arguments_delta:((E=P.function)==null?void 0:E.arguments)??""}):(I==null||I.type,void 0))}}},ys=function(t,n){var i,o,c;if(h(this,U,"m",hn).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const l=(c=(o=h(this,_e,"f"))==null?void 0:o.tools)==null?void 0:c.find(m=>Mn(m)&&m.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:Wt(l)?l.$parseRaw(a.function.arguments):l!=null&&l.function.strict?JSON.parse(a.function.arguments):null})}else a.type},ws=function(t){var r,a;const n=h(this,U,"m",hn).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=h(this,U,"m",bs).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},dn=function(){if(this.ended)throw new x("stream has ended, this shouldn't happen");const t=h(this,xe,"f");if(!t)throw new x("request ended without sending any chunks");return k(this,xe,void 0),k(this,qe,[]),Wl(t,h(this,_e,"f"))},bs=function(){var n;const t=(n=h(this,_e,"f"))==null?void 0:n.response_format;return er(t)?t:null},ca=function(t){var n,r,a,i;let o=h(this,xe,"f");const{choices:c,...l}=t;o?Object.assign(o,l):o=k(this,xe,{...l,choices:[]});for(const{delta:m,finish_reason:f,index:g,logprobs:u=null,..._}of t.choices){let y=o.choices[g];if(y||(y=o.choices[g]={finish_reason:f,index:g,message:{},logprobs:u,..._}),u)if(!y.logprobs)y.logprobs=Object.assign({},u);else{const{content:P,refusal:I,...z}=u;Object.assign(y.logprobs,z),P&&((n=y.logprobs).content??(n.content=[]),y.logprobs.content.push(...P)),I&&((r=y.logprobs).refusal??(r.refusal=[]),y.logprobs.refusal.push(...I))}if(f&&(y.finish_reason=f,h(this,_e,"f")&&Ki(h(this,_e,"f")))){if(f==="length")throw new Ci;if(f==="content_filter")throw new Ii}if(Object.assign(y,_),!m)continue;const{content:R,refusal:M,function_call:E,role:v,tool_calls:S,...L}=m;if(Object.assign(y.message,L),M&&(y.message.refusal=(y.message.refusal||"")+M),v&&(y.message.role=v),E&&(y.message.function_call?(E.name&&(y.message.function_call.name=E.name),E.arguments&&((a=y.message.function_call).arguments??(a.arguments=""),y.message.function_call.arguments+=E.arguments)):y.message.function_call=E),R&&(y.message.content=(y.message.content||"")+R,!y.message.refusal&&h(this,U,"m",bs).call(this)&&(y.message.parsed=oa(y.message.content))),S){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:P,id:I,type:z,function:T,...B}of S){const N=(i=y.message.tool_calls)[P]??(i[P]={});Object.assign(N,B),I&&(N.id=I),z&&(N.type=z),T&&(N.function??(N.function={name:T.name??"",arguments:""})),T!=null&&T.name&&(N.function.name=T.name),T!=null&&T.arguments&&(N.function.arguments+=T.arguments,Pl(h(this,_e,"f"),N)&&(N.function.parsed_arguments=oa(N.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Wl(s,e){const{id:t,choices:n,created:r,model:a,system_fingerprint:i,...o}=s,c={...o,id:t,choices:n.map(({message:l,finish_reason:m,index:f,logprobs:g,...u})=>{if(!m)throw new x(`missing finish_reason for choice ${f}`);const{content:_=null,function_call:y,tool_calls:R,...M}=l,E=l.role;if(!E)throw new x(`missing role for choice ${f}`);if(y){const{arguments:v,name:S}=y;if(v==null)throw new x(`missing function_call.arguments for choice ${f}`);if(!S)throw new x(`missing function_call.name for choice ${f}`);return{...u,message:{content:_,function_call:{arguments:v,name:S},role:E,refusal:l.refusal??null},finish_reason:m,index:f,logprobs:g}}return R?{...u,index:f,finish_reason:m,logprobs:g,message:{...M,role:E,content:_,refusal:l.refusal??null,tool_calls:R.map((v,S)=>{const{function:L,type:P,id:I,...z}=v,{arguments:T,name:B,...N}=L||{};if(I==null)throw new x(`missing choices[${f}].tool_calls[${S}].id
${fn(s)}`);if(P==null)throw new x(`missing choices[${f}].tool_calls[${S}].type
${fn(s)}`);if(B==null)throw new x(`missing choices[${f}].tool_calls[${S}].function.name
${fn(s)}`);if(T==null)throw new x(`missing choices[${f}].tool_calls[${S}].function.arguments
${fn(s)}`);return{...z,id:I,type:P,function:{...N,name:B,arguments:T}}})}}:{...u,message:{...M,content:_,role:E,refusal:l.refusal??null},finish_reason:m,index:f,logprobs:g}}),created:r,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Ol(c,e)}function fn(s){return JSON.stringify(s)}class Fn extends Lt{static fromReadableStream(e){const t=new Fn(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){const r=new Fn(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let rr=class extends A{constructor(){super(...arguments),this.messages=new Xi(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(p`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(p`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",F,{query:e,...t})}delete(e,t){return this._client.delete(p`/chat/completions/${e}`,t)}parse(e,t){return Nl(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>tr(n,e))}runTools(e,t){return e.stream?Fn.runTools(this._client,e,t):sr.runTools(this._client,e,t)}stream(e,t){return Lt.createChatCompletion(this._client,e,t)}};rr.Messages=Xi;class ar extends A{constructor(){super(...arguments),this.completions=new rr(this._client)}}ar.Completions=rr;const go=Symbol("brand.privateNullableHeaders");function*Hl(s){if(!s)return;if(go in s){const{values:n,nulls:r}=s;yield*n.entries();for(const a of r)yield[a,null];return}let e=!1,t;s instanceof Headers?t=s.entries():Gr(s)?t=s:(e=!0,t=Object.entries(s??{}));for(let n of t){const r=n[0];if(typeof r!="string")throw new TypeError("expected header name to be a string");const a=Gr(n[1])?n[1]:[n[1]];let i=!1;for(const o of a)o!==void 0&&(e&&!i&&(i=!0,yield[r,null]),yield[r,o])}}const b=s=>{const e=new Headers,t=new Set;for(const n of s){const r=new Set;for(const[a,i]of Hl(n)){const o=a.toLowerCase();r.has(o)||(e.delete(a),r.add(o)),i===null?(e.delete(a),t.add(o)):(e.append(a,i),t.delete(o))}}return{[go]:!0,values:e,nulls:t}};class po extends A{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:b([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class _o extends A{create(e,t){return this._client.post("/audio/transcriptions",Ne({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class yo extends A{create(e,t){return this._client.post("/audio/translations",Ne({body:e,...t,__metadata:{model:e.model}},this._client))}}class Ht extends A{constructor(){super(...arguments),this.transcriptions=new _o(this._client),this.translations=new yo(this._client),this.speech=new po(this._client)}}Ht.Transcriptions=_o;Ht.Translations=yo;Ht.Speech=po;class wo extends A{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(p`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",F,{query:e,...t})}cancel(e,t){return this._client.post(p`/batches/${e}/cancel`,t)}}class bo extends A{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(p`/assistants/${e}`,{...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(p`/assistants/${e}`,{body:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},t){return this._client.getAPIList("/assistants",F,{query:e,...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(p`/assistants/${e}`,{...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}let So=class extends A{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}};class Ao extends A{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}let Vn=class extends A{constructor(){super(...arguments),this.sessions=new So(this._client),this.transcriptionSessions=new Ao(this._client)}};Vn.Sessions=So;Vn.TranscriptionSessions=Ao;class xo extends A{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:b([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}cancel(e,t){return this._client.post(p`/chatkit/sessions/${e}/cancel`,{...t,headers:b([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}}let Ro=class extends A{retrieve(e,t){return this._client.get(p`/chatkit/threads/${e}`,{...t,headers:b([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",Tn,{query:e,...t,headers:b([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(p`/chatkit/threads/${e}`,{...t,headers:b([{"OpenAI-Beta":"chatkit_beta=v1"},t==null?void 0:t.headers])})}listItems(e,t={},n){return this._client.getAPIList(p`/chatkit/threads/${e}/items`,Tn,{query:t,...n,headers:b([{"OpenAI-Beta":"chatkit_beta=v1"},n==null?void 0:n.headers])})}};class Yn extends A{constructor(){super(...arguments),this.sessions=new xo(this._client),this.threads=new Ro(this._client)}}Yn.Sessions=xo;Yn.Threads=Ro;class Eo extends A{create(e,t,n){return this._client.post(p`/threads/${e}/messages`,{body:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(p`/threads/${r}/messages/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(p`/threads/${r}/messages/${e}`,{body:a,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(p`/threads/${e}/messages`,F,{query:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t,n){const{thread_id:r}=t;return this._client.delete(p`/threads/${r}/messages/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class vo extends A{retrieve(e,t,n){const{thread_id:r,run_id:a,...i}=t;return this._client.get(p`/threads/${r}/runs/${a}/steps/${e}`,{query:i,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t,n){const{thread_id:r,...a}=t;return this._client.getAPIList(p`/threads/${r}/runs/${e}/steps`,F,{query:a,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}const Jl=s=>{if(typeof Buffer<"u"){const e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};var Ss={};const We=s=>{var e,t,n,r;if(typeof globalThis.process<"u")return((e=Ss==null?void 0:Ss[s])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(r=(n=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,s))==null?void 0:r.trim()};var J,Me,js,fe,An,le,Pe,ze,Te,Dn,re,xn,Rn,Ot,$t,Ct,la,ua,ha,da,fa,ma,ga;class Tt extends nr{constructor(){super(...arguments),J.add(this),js.set(this,[]),fe.set(this,{}),An.set(this,{}),le.set(this,void 0),Pe.set(this,void 0),ze.set(this,void 0),Te.set(this,void 0),Dn.set(this,void 0),re.set(this,void 0),xn.set(this,void 0),Rn.set(this,void 0),Ot.set(this,void 0)}[(js=new WeakMap,fe=new WeakMap,An=new WeakMap,le=new WeakMap,Pe=new WeakMap,ze=new WeakMap,Te=new WeakMap,Dn=new WeakMap,re=new WeakMap,xn=new WeakMap,Rn=new WeakMap,Ot=new WeakMap,J=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Me;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=me.fromReadableStream(e,this.controller);for await(const i of r)h(this,J,"m",$t).call(this,i);if((a=r.controller.signal)!=null&&a.aborted)throw new ce;return this._addRun(h(this,J,"m",Ct).call(this))}toReadableStream(){return new me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r){const a=new Me;return a._run(()=>a._runToolAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,r){var c;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.submitToolOutputs(t,i,{...r,signal:this.controller.signal});this._connected();for await(const l of o)h(this,J,"m",$t).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new ce;return this._addRun(h(this,J,"m",Ct).call(this))}static createThreadAssistantStream(e,t,n){const r=new Me;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new Me;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return h(this,xn,"f")}currentRun(){return h(this,Rn,"f")}currentMessageSnapshot(){return h(this,le,"f")}currentRunStepSnapshot(){return h(this,Ot,"f")}async finalRunSteps(){return await this.done(),Object.values(h(this,fe,"f"))}async finalMessages(){return await this.done(),Object.values(h(this,An,"f"))}async finalRun(){if(await this.done(),!h(this,Pe,"f"))throw Error("Final run was not received.");return h(this,Pe,"f")}async _createThreadAssistantStream(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const c of i)h(this,J,"m",$t).call(this,c);if((o=i.controller.signal)!=null&&o.aborted)throw new ce;return this._addRun(h(this,J,"m",Ct).call(this))}async _createAssistantStream(e,t,n,r){var c;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const l of o)h(this,J,"m",$t).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new ce;return this._addRun(h(this,J,"m",Ct).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let a=e[n];if(a==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(fs(a)&&fs(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...r);continue}for(const i of r){if(!fs(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=a[o];c==null?a.push(i):a[o]=this.accumulateDelta(c,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r){return await this._createToolAssistantStream(t,e,n,r)}}Me=Tt,$t=function(e){if(!this.ended)switch(k(this,xn,e),h(this,J,"m",ha).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":h(this,J,"m",ga).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":h(this,J,"m",ua).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":h(this,J,"m",la).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ct=function(){if(this.ended)throw new x("stream has ended, this shouldn't happen");if(!h(this,Pe,"f"))throw Error("Final run has not been received");return h(this,Pe,"f")},la=function(e){const[t,n]=h(this,J,"m",fa).call(this,e,h(this,le,"f"));k(this,le,t),h(this,An,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,i=t.content[r.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=h(this,ze,"f")){if(h(this,Te,"f"))switch(h(this,Te,"f").type){case"text":this._emit("textDone",h(this,Te,"f").text,h(this,le,"f"));break;case"image_file":this._emit("imageFileDone",h(this,Te,"f").image_file,h(this,le,"f"));break}k(this,ze,r.index)}k(this,Te,t.content[r.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(h(this,ze,"f")!==void 0){const r=e.data.content[h(this,ze,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,h(this,le,"f"));break;case"text":this._emit("textDone",r.text,h(this,le,"f"));break}}h(this,le,"f")&&this._emit("messageDone",e.data),k(this,le,void 0)}},ua=function(e){const t=h(this,J,"m",da).call(this,e);switch(k(this,Ot,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==h(this,Dn,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(h(this,re,"f")&&this._emit("toolCallDone",h(this,re,"f")),k(this,Dn,a.index),k(this,re,t.step_details.tool_calls[a.index]),h(this,re,"f")&&this._emit("toolCallCreated",h(this,re,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":k(this,Ot,void 0),e.data.step_details.type=="tool_calls"&&h(this,re,"f")&&(this._emit("toolCallDone",h(this,re,"f")),k(this,re,void 0)),this._emit("runStepDone",e.data,t);break}},ha=function(e){h(this,js,"f").push(e),this._emit("event",e)},da=function(e){switch(e.event){case"thread.run.step.created":return h(this,fe,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=h(this,fe,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=Me.accumulateDelta(t,n.delta);h(this,fe,"f")[e.data.id]=r}return h(this,fe,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":h(this,fe,"f")[e.data.id]=e.data;break}if(h(this,fe,"f")[e.data.id])return h(this,fe,"f")[e.data.id];throw new Error("No snapshot available")},fa=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=h(this,J,"m",ma).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ma=function(e,t){return Me.accumulateDelta(t,e)},ga=function(e){switch(k(this,Rn,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":k(this,Pe,e.data),h(this,re,"f")&&(this._emit("toolCallDone",h(this,re,"f")),k(this,re,void 0));break}};let ir=class extends A{constructor(){super(...arguments),this.steps=new vo(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post(p`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}retrieve(e,t,n){const{thread_id:r}=t;return this._client.get(p`/threads/${r}/runs/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{thread_id:r,...a}=t;return this._client.post(p`/threads/${r}/runs/${e}`,{body:a,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(p`/threads/${e}/runs`,F,{query:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,t,n){const{thread_id:r}=t;return this._client.post(p`/threads/${r}/runs/${e}/cancel`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(r.id,{thread_id:e},n)}createAndStream(e,t,n){return Tt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){var a;const r=b([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:i,response:o}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...r}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const l=o.headers.get("openai-poll-after-ms");if(l){const m=parseInt(l);isNaN(m)||(c=m)}}await qt(c);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,n){return Tt.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){const{thread_id:r,...a}=t;return this._client.post(p`/threads/${r}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){const r=await this.submitToolOutputs(e,t,n);return await this.poll(r.id,t,n)}submitToolOutputsStream(e,t,n){return Tt.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};ir.Steps=vo;class zn extends A{constructor(){super(...arguments),this.runs=new ir(this._client),this.messages=new Eo(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(p`/threads/${e}`,{...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(p`/threads/${e}`,{body:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t){return this._client.delete(p`/threads/${e}`,{...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return Tt.createThreadAssistantStream(e,this._client.beta.threads,t)}}zn.Runs=ir;zn.Messages=Eo;class et extends A{constructor(){super(...arguments),this.realtime=new Vn(this._client),this.chatkit=new Yn(this._client),this.assistants=new bo(this._client),this.threads=new zn(this._client)}}et.Realtime=Vn;et.ChatKit=Yn;et.Assistants=bo;et.Threads=zn;class ko extends A{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class $o extends A{retrieve(e,t,n){const{container_id:r}=t;return this._client.get(p`/containers/${r}/files/${e}/content`,{...n,headers:b([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}}let or=class extends A{constructor(){super(...arguments),this.content=new $o(this._client)}create(e,t,n){return this._client.post(p`/containers/${e}/files`,Ne({body:t,...n},this._client))}retrieve(e,t,n){const{container_id:r}=t;return this._client.get(p`/containers/${r}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(p`/containers/${e}/files`,F,{query:t,...n})}delete(e,t,n){const{container_id:r}=t;return this._client.delete(p`/containers/${r}/files/${e}`,{...n,headers:b([{Accept:"*/*"},n==null?void 0:n.headers])})}};or.Content=$o;class cr extends A{constructor(){super(...arguments),this.files=new or(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(p`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",F,{query:e,...t})}delete(e,t){return this._client.delete(p`/containers/${e}`,{...t,headers:b([{Accept:"*/*"},t==null?void 0:t.headers])})}}cr.Files=or;class Co extends A{create(e,t,n){const{include:r,...a}=t;return this._client.post(p`/conversations/${e}/items`,{query:{include:r},body:a,...n})}retrieve(e,t,n){const{conversation_id:r,...a}=t;return this._client.get(p`/conversations/${r}/items/${e}`,{query:a,...n})}list(e,t={},n){return this._client.getAPIList(p`/conversations/${e}/items`,Tn,{query:t,...n})}delete(e,t,n){const{conversation_id:r}=t;return this._client.delete(p`/conversations/${r}/items/${e}`,n)}}class lr extends A{constructor(){super(...arguments),this.items=new Co(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(p`/conversations/${e}`,t)}update(e,t,n){return this._client.post(p`/conversations/${e}`,{body:t,...n})}delete(e,t){return this._client.delete(p`/conversations/${e}`,t)}}lr.Items=Co;class Io extends A{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&H(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:(H(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const c=o.embedding;o.embedding=Jl(c)}),i)))}}class Oo extends A{retrieve(e,t,n){const{eval_id:r,run_id:a}=t;return this._client.get(p`/evals/${r}/runs/${a}/output_items/${e}`,n)}list(e,t,n){const{eval_id:r,...a}=t;return this._client.getAPIList(p`/evals/${r}/runs/${e}/output_items`,F,{query:a,...n})}}class ur extends A{constructor(){super(...arguments),this.outputItems=new Oo(this._client)}create(e,t,n){return this._client.post(p`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){const{eval_id:r}=t;return this._client.get(p`/evals/${r}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(p`/evals/${e}/runs`,F,{query:t,...n})}delete(e,t,n){const{eval_id:r}=t;return this._client.delete(p`/evals/${r}/runs/${e}`,n)}cancel(e,t,n){const{eval_id:r}=t;return this._client.post(p`/evals/${r}/runs/${e}`,n)}}ur.OutputItems=Oo;class hr extends A{constructor(){super(...arguments),this.runs=new ur(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(p`/evals/${e}`,t)}update(e,t,n){return this._client.post(p`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",F,{query:e,...t})}delete(e,t){return this._client.delete(p`/evals/${e}`,t)}}hr.Runs=ur;let To=class extends A{create(e,t){return this._client.post("/files",Ne({body:e,...t},this._client))}retrieve(e,t){return this._client.get(p`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",F,{query:e,...t})}delete(e,t){return this._client.delete(p`/files/${e}`,t)}content(e,t){return this._client.get(p`/files/${e}/content`,{...t,headers:b([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await qt(t),i=await this.retrieve(e),Date.now()-a>n)throw new Ys({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class Mo extends A{}let Po=class extends A{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class dr extends A{constructor(){super(...arguments),this.graders=new Po(this._client)}}dr.Graders=Po;class No extends A{create(e,t,n){return this._client.getAPIList(p`/fine_tuning/checkpoints/${e}/permissions`,Kn,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(p`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){const{fine_tuned_model_checkpoint:r}=t;return this._client.delete(p`/fine_tuning/checkpoints/${r}/permissions/${e}`,n)}}let fr=class extends A{constructor(){super(...arguments),this.permissions=new No(this._client)}};fr.Permissions=No;class Lo extends A{list(e,t={},n){return this._client.getAPIList(p`/fine_tuning/jobs/${e}/checkpoints`,F,{query:t,...n})}}class mr extends A{constructor(){super(...arguments),this.checkpoints=new Lo(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(p`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",F,{query:e,...t})}cancel(e,t){return this._client.post(p`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(p`/fine_tuning/jobs/${e}/events`,F,{query:t,...n})}pause(e,t){return this._client.post(p`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(p`/fine_tuning/jobs/${e}/resume`,t)}}mr.Checkpoints=Lo;class tt extends A{constructor(){super(...arguments),this.methods=new Mo(this._client),this.jobs=new mr(this._client),this.checkpoints=new fr(this._client),this.alpha=new dr(this._client)}}tt.Methods=Mo;tt.Jobs=mr;tt.Checkpoints=fr;tt.Alpha=dr;class Bo extends A{}class gr extends A{constructor(){super(...arguments),this.graderModels=new Bo(this._client)}}gr.GraderModels=Bo;class Fo extends A{createVariation(e,t){return this._client.post("/images/variations",Ne({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ne({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class Do extends A{retrieve(e,t){return this._client.get(p`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Kn,e)}delete(e,t){return this._client.delete(p`/models/${e}`,t)}}class Uo extends A{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class jo extends A{accept(e,t,n){return this._client.post(p`/realtime/calls/${e}/accept`,{body:t,...n,headers:b([{Accept:"*/*"},n==null?void 0:n.headers])})}hangup(e,t){return this._client.post(p`/realtime/calls/${e}/hangup`,{...t,headers:b([{Accept:"*/*"},t==null?void 0:t.headers])})}refer(e,t,n){return this._client.post(p`/realtime/calls/${e}/refer`,{body:t,...n,headers:b([{Accept:"*/*"},n==null?void 0:n.headers])})}reject(e,t={},n){return this._client.post(p`/realtime/calls/${e}/reject`,{body:t,...n,headers:b([{Accept:"*/*"},n==null?void 0:n.headers])})}}class qo extends A{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class Qn extends A{constructor(){super(...arguments),this.clientSecrets=new qo(this._client),this.calls=new jo(this._client)}}Qn.ClientSecrets=qo;Qn.Calls=jo;function Gl(s,e){return!e||!Kl(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Wo(s,e)}function Wo(s,e){const t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:zl(e,r)};if(r.type==="message"){const a=r.content.map(i=>i.type==="output_text"?{...i,parsed:Xl(e,i.text)}:i);return{...r,content:a}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||qs(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const r of n.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function Xl(s,e){var t,n,r,a;return((n=(t=s.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((r=s.text)==null?void 0:r.format)?((a=s.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function Kl(s){var e;return!!er((e=s.text)==null?void 0:e.format)}function Vl(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function Yl(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function zl(s,e){const t=Yl(s.tools??[],e.name);return{...e,...e,parsed_arguments:Vl(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function qs(s){const e=[];for(const t of s.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}var He,mn,Re,gn,pa,_a,ya,wa;class pr extends nr{constructor(e){super(),He.add(this),mn.set(this,void 0),Re.set(this,void 0),gn.set(this,void 0),k(this,mn,e)}static createResponse(e,t,n){const r=new pr(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),h(this,He,"m",pa).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const c of a)h(this,He,"m",_a).call(this,c,i);if((o=a.controller.signal)!=null&&o.aborted)throw new ce;return h(this,He,"m",ya).call(this)}[(mn=new WeakMap,Re=new WeakMap,gn=new WeakMap,He=new WeakSet,pa=function(){this.ended||k(this,Re,void 0)},_a=function(t,n){if(this.ended)return;const r=(i,o)=>{(n==null||o.sequence_number>n)&&this._emit(i,o)},a=h(this,He,"m",wa).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const i=a.output[t.output_index];if(!i)throw new x(`missing output at index ${t.output_index}`);if(i.type==="message"){const o=i.content[t.content_index];if(!o)throw new x(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new x(`expected content to be 'output_text', got ${o.type}`);r("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const i=a.output[t.output_index];if(!i)throw new x(`missing output at index ${t.output_index}`);i.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:r(t.type,t);break}},ya=function(){if(this.ended)throw new x("stream has ended, this shouldn't happen");const t=h(this,Re,"f");if(!t)throw new x("request ended without sending any events");k(this,Re,void 0);const n=Ql(t,h(this,mn,"f"));return k(this,gn,n),n},wa=function(t){var r;let n=h(this,Re,"f");if(!n){if(t.type!=="response.created")throw new x(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=k(this,Re,t.response),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const a=n.output[t.output_index];if(!a)throw new x(`missing output at index ${t.output_index}`);const i=a.type,o=t.part;i==="message"&&o.type!=="reasoning_text"?a.content.push(o):i==="reasoning"&&o.type==="reasoning_text"&&(a.content||(a.content=[]),a.content.push(o));break}case"response.output_text.delta":{const a=n.output[t.output_index];if(!a)throw new x(`missing output at index ${t.output_index}`);if(a.type==="message"){const i=a.content[t.content_index];if(!i)throw new x(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new x(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{const a=n.output[t.output_index];if(!a)throw new x(`missing output at index ${t.output_index}`);a.type==="function_call"&&(a.arguments+=t.delta);break}case"response.reasoning_text.delta":{const a=n.output[t.output_index];if(!a)throw new x(`missing output at index ${t.output_index}`);if(a.type==="reasoning"){const i=(r=a.content)==null?void 0:r[t.content_index];if(!i)throw new x(`missing content at index ${t.content_index}`);if(i.type!=="reasoning_text")throw new x(`expected content to be 'reasoning_text', got ${i.type}`);i.text+=t.delta}break}case"response.completed":{k(this,Re,t.response);break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=h(this,gn,"f");if(!e)throw new x("stream ended without producing a ChatCompletion");return e}}function Ql(s,e){return Gl(s,e)}class Ho extends A{list(e,t={},n){return this._client.getAPIList(p`/responses/${e}/input_items`,F,{query:t,...n})}}class Jo extends A{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class Zn extends A{constructor(){super(...arguments),this.inputItems=new Ho(this._client),this.inputTokens=new Jo(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&qs(n),n))}retrieve(e,t={},n){return this._client.get(p`/responses/${e}`,{query:t,...n,stream:(t==null?void 0:t.stream)??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&qs(r),r))}delete(e,t){return this._client.delete(p`/responses/${e}`,{...t,headers:b([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Wo(n,e))}stream(e,t){return pr.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(p`/responses/${e}/cancel`,t)}compact(e,t){return this._client.post("/responses/compact",{body:e,...t})}}Zn.InputItems=Ho;Zn.InputTokens=Jo;class Go extends A{create(e,t,n){return this._client.post(p`/uploads/${e}/parts`,Ne({body:t,...n},this._client))}}class _r extends A{constructor(){super(...arguments),this.parts=new Go(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(p`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(p`/uploads/${e}/complete`,{body:t,...n})}}_r.Parts=Go;const Zl=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};class Xo extends A{create(e,t,n){return this._client.post(p`/vector_stores/${e}/file_batches`,{body:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(p`/vector_stores/${r}/file_batches/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}cancel(e,t,n){const{vector_store_id:r}=t;return this._client.post(p`/vector_stores/${r}/file_batches/${e}/cancel`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n){const{vector_store_id:r,...a}=t;return this._client.getAPIList(p`/vector_stores/${r}/file_batches/${e}/files`,F,{query:a,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async poll(e,t,n){var a;const r=b([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:i,response:o}=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse();switch(i.status){case"in_progress":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const l=o.headers.get("openai-poll-after-ms");if(l){const m=parseInt(l);isNaN(m)||(c=m)}}await qt(c);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(r==null?void 0:r.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,c=t.values(),l=[...n];async function m(g){for(let u of g){const _=await o.files.create({file:u,purpose:"assistants"},r);l.push(_.id)}}const f=Array(i).fill(c).map(m);return await Zl(f),await this.createAndPoll(e,{file_ids:l})}}class Ko extends A{create(e,t,n){return this._client.post(p`/vector_stores/${e}/files`,{body:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,t,n){const{vector_store_id:r}=t;return this._client.get(p`/vector_stores/${r}/files/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,t,n){const{vector_store_id:r,...a}=t;return this._client.post(p`/vector_stores/${r}/files/${e}`,{body:a,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e,t={},n){return this._client.getAPIList(p`/vector_stores/${e}/files`,F,{query:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,t,n){const{vector_store_id:r}=t;return this._client.delete(p`/vector_stores/${r}/files/${e}`,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){var a;const r=b([n==null?void 0:n.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=n==null?void 0:n.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const i=await this.retrieve(t,{vector_store_id:e},{...n,headers:r}).withResponse(),o=i.data;switch(o.status){case"in_progress":let c=5e3;if(n!=null&&n.pollIntervalMs)c=n.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const m=parseInt(l);isNaN(m)||(c=m)}}await qt(c);break;case"failed":case"completed":return o}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){const{vector_store_id:r}=t;return this._client.getAPIList(p`/vector_stores/${r}/files/${e}/content`,Kn,{...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class es extends A{constructor(){super(...arguments),this.files=new Ko(this._client),this.fileBatches=new Xo(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(p`/vector_stores/${e}`,{...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,n){return this._client.post(p`/vector_stores/${e}`,{body:t,...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",F,{query:e,...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(p`/vector_stores/${e}`,{...t,headers:b([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,n){return this._client.getAPIList(p`/vector_stores/${e}/search`,Kn,{body:t,method:"post",...n,headers:b([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}es.Files=Ko;es.FileBatches=Xo;class Vo extends A{create(e,t){return this._client.post("/videos",ra({body:e,...t},this._client))}retrieve(e,t){return this._client.get(p`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",Tn,{query:e,...t})}delete(e,t){return this._client.delete(p`/videos/${e}`,t)}downloadContent(e,t={},n){return this._client.get(p`/videos/${e}/content`,{query:t,...n,headers:b([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}remix(e,t,n){return this._client.post(p`/videos/${e}/remix`,ra({body:t,...n},this._client))}}var Ye,Yo,En;class zo extends A{constructor(){super(...arguments),Ye.add(this)}async unwrap(e,t,n=this._client.webhookSecret,r=300){return await this.verifySignature(e,t,n,r),JSON.parse(e)}async verifySignature(e,t,n=this._client.webhookSecret,r=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");h(this,Ye,"m",Yo).call(this,n);const a=b([t]).values,i=h(this,Ye,"m",En).call(this,a,"webhook-signature"),o=h(this,Ye,"m",En).call(this,a,"webhook-timestamp"),c=h(this,Ye,"m",En).call(this,a,"webhook-id"),l=parseInt(o,10);if(isNaN(l))throw new St("Invalid webhook timestamp format");const m=Math.floor(Date.now()/1e3);if(m-l>r)throw new St("Webhook timestamp is too old");if(l>m+r)throw new St("Webhook timestamp is too new");const f=i.split(" ").map(y=>y.startsWith("v1,")?y.substring(3):y),g=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),u=c?`${c}.${o}.${e}`:`${o}.${e}`,_=await crypto.subtle.importKey("raw",g,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const y of f)try{const R=Buffer.from(y,"base64");if(await crypto.subtle.verify("HMAC",_,R,new TextEncoder().encode(u)))return}catch{continue}throw new St("The given webhook signature does not match the expected signature")}}Ye=new WeakSet,Yo=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},En=function(e,t){if(!e)throw new Error("Headers are required");const n=e.get(t);if(n==null)throw new Error(`Missing required header: ${t}`);return n};var Ws,yr,vn,Qo;class C{constructor({baseURL:e=We("OPENAI_BASE_URL"),apiKey:t=We("OPENAI_API_KEY"),organization:n=We("OPENAI_ORG_ID")??null,project:r=We("OPENAI_PROJECT_ID")??null,webhookSecret:a=We("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(Ws.add(this),vn.set(this,void 0),this.completions=new ko(this),this.chat=new ar(this),this.embeddings=new Io(this),this.files=new To(this),this.images=new Fo(this),this.audio=new Ht(this),this.moderations=new Uo(this),this.models=new Do(this),this.fineTuning=new tt(this),this.graders=new gr(this),this.vectorStores=new es(this),this.webhooks=new zo(this),this.beta=new et(this),this.batches=new wo(this),this.uploads=new _r(this),this.responses=new Zn(this),this.realtime=new Qn(this),this.conversations=new lr(this),this.evals=new hr(this),this.containers=new cr(this),this.videos=new Vo(this),t===void 0)throw new x("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const o={apiKey:t,organization:n,project:r,webhookSecret:a,...i,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&tl())throw new x(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??yr.DEFAULT_TIMEOUT,this.logger=o.logger??console;const c="warn";this.logLevel=c,this.logLevel=na(o.logLevel,"ClientOptions.logLevel",this)??na(We("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??c,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??il(),k(this,vn,cl),this._options=o,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=n,this.project=r,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return b([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return ml(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Ke}`}defaultIdempotencyKey(){return`stainless-node-retry-${bi()}`}makeStatusError(e,t,n,r){return X.generate(e,t,n,r)}async _callApiKey(){const e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(n){throw n instanceof x?n:new x(`Failed to get token from 'apiKey' function: ${n.message}`,{cause:n})}if(typeof t!="string"||!t)throw new x(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,n){const r=!h(this,Ws,"m",Qo).call(this)&&n||this.baseURL,a=Yc(e)?new URL(e):new URL(r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return zc(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new Xn(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var M,E;const r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);const{req:i,url:o,timeout:c}=await this.buildRequest(r,{retryCount:a-t});await this.prepareRequest(i,{url:o,options:r});const l="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=n===void 0?"":`, retryOf: ${n}`,f=Date.now();if(H(this).debug(`[${l}] sending request`,Oe({retryOfRequestLogID:n,method:r.method,url:o,options:r,headers:i.headers})),(M=r.signal)!=null&&M.aborted)throw new ce;const g=new AbortController,u=await this.fetchWithTimeout(o,i,c,g).catch(Os),_=Date.now();if(u instanceof globalThis.Error){const v=`retrying, ${t} attempts remaining`;if((E=r.signal)!=null&&E.aborted)throw new ce;const S=Is(u)||/timed? ?out/i.test(String(u)+("cause"in u?String(u.cause):""));if(t)return H(this).info(`[${l}] connection ${S?"timed out":"failed"} - ${v}`),H(this).debug(`[${l}] connection ${S?"timed out":"failed"} (${v})`,Oe({retryOfRequestLogID:n,url:o,durationMs:_-f,message:u.message})),this.retryRequest(r,t,n??l);throw H(this).info(`[${l}] connection ${S?"timed out":"failed"} - error; no more retries left`),H(this).debug(`[${l}] connection ${S?"timed out":"failed"} (error; no more retries left)`,Oe({retryOfRequestLogID:n,url:o,durationMs:_-f,message:u.message})),S?new Ys:new Jn({cause:u})}const y=[...u.headers.entries()].filter(([v])=>v==="x-request-id").map(([v,S])=>", "+v+": "+JSON.stringify(S)).join(""),R=`[${l}${m}${y}] ${i.method} ${o} ${u.ok?"succeeded":"failed"} with status ${u.status} in ${_-f}ms`;if(!u.ok){const v=await this.shouldRetry(u);if(t&&v){const T=`retrying, ${t} attempts remaining`;return await ol(u.body),H(this).info(`${R} - ${T}`),H(this).debug(`[${l}] response error (${T})`,Oe({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,durationMs:_-f})),this.retryRequest(r,t,n??l,u.headers)}const S=v?"error; no more retries left":"error; not retryable";H(this).info(`${R} - ${S}`);const L=await u.text().catch(T=>Os(T).message),P=el(L),I=P?void 0:L;throw H(this).debug(`[${l}] response error (${S})`,Oe({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,message:I,durationMs:Date.now()-f})),this.makeStatusError(u.status,P,I,u.headers)}return H(this).info(R),H(this).debug(`[${l}] response start`,Oe({retryOfRequestLogID:n,url:u.url,status:u.status,headers:u.headers,durationMs:_-f})),{response:u,options:r,controller:g,requestLogID:l,retryOfRequestLogID:n,startTime:f}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){const n=this.makeRequest(t,null,void 0);return new xl(this,n,e)}async fetchWithTimeout(e,t,n,r){const{signal:a,method:i,...o}=t||{};a&&a.addEventListener("abort",()=>r.abort());const c=setTimeout(()=>r.abort(),n),l=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,m={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...o};i&&(m.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,m)}finally{clearTimeout(c)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,r){let a;const i=r==null?void 0:r.get("retry-after-ms");if(i){const c=parseFloat(i);Number.isNaN(c)||(a=c)}const o=r==null?void 0:r.get("retry-after");if(o&&!a){const c=parseFloat(o);Number.isNaN(c)?a=Date.parse(o)-Date.now():a=c*1e3}if(!(a&&0<=a&&a<60*1e3)){const c=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,c)}return await qt(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}async buildRequest(e,{retryCount:t=0}={}){const n={...e},{method:r,path:a,query:i,defaultBaseURL:o}=n,c=this.buildURL(a,i,o);"timeout"in n&&Zc("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:l,body:m}=this.buildBody({options:n}),f=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:f,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"},...m&&{body:m},...this.fetchOptions??{},...n.fetchOptions??{}},url:c,timeout:n.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:r}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const i=b([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...al(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=b([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Mi(e)}:h(this,vn,"f").call(this,{body:e,headers:n})}}yr=C,vn=new WeakMap,Ws=new WeakSet,Qo=function(){return this.baseURL!=="https://api.openai.com/v1"};C.OpenAI=yr;C.DEFAULT_TIMEOUT=6e5;C.OpenAIError=x;C.APIError=X;C.APIConnectionError=Jn;C.APIConnectionTimeoutError=Ys;C.APIUserAbortError=ce;C.NotFoundError=Ri;C.ConflictError=Ei;C.RateLimitError=ki;C.BadRequestError=Si;C.AuthenticationError=Ai;C.InternalServerError=$i;C.PermissionDeniedError=xi;C.UnprocessableEntityError=vi;C.InvalidWebhookSignatureError=St;C.toFile=$l;C.Completions=ko;C.Chat=ar;C.Embeddings=Io;C.Files=To;C.Images=Fo;C.Audio=Ht;C.Moderations=Uo;C.Models=Do;C.FineTuning=tt;C.Graders=gr;C.VectorStores=es;C.Webhooks=zo;C.Beta=et;C.Batches=wo;C.Uploads=_r;C.Responses=Zn;C.Realtime=Qn;C.Conversations=lr;C.Evals=hr;C.Containers=cr;C.Videos=Vo;var ba;(function(s){s.STRING="string",s.NUMBER="number",s.INTEGER="integer",s.BOOLEAN="boolean",s.ARRAY="array",s.OBJECT="object"})(ba||(ba={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sa;(function(s){s.LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python"})(Sa||(Sa={}));var Aa;(function(s){s.OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(Aa||(Aa={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xa=["user","model","function","system"];var Ra;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",s.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Ra||(Ra={}));var Ea;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(Ea||(Ea={}));var va;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(va||(va={}));var ka;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER"})(ka||(ka={}));var Mt;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.BLOCKLIST="BLOCKLIST",s.PROHIBITED_CONTENT="PROHIBITED_CONTENT",s.SPII="SPII",s.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",s.OTHER="OTHER"})(Mt||(Mt={}));var $a;(function(s){s.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",s.RETRIEVAL_QUERY="RETRIEVAL_QUERY",s.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",s.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",s.CLASSIFICATION="CLASSIFICATION",s.CLUSTERING="CLUSTERING"})($a||($a={}));var Ca;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(Ca||(Ca={}));var Ia;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Ia||(Ia={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class Je extends K{constructor(e,t){super(e),this.response=t}}class Zo extends K{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class ve extends K{}class ec extends K{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eu="https://generativelanguage.googleapis.com",tu="v1beta",nu="0.24.1",su="genai-js";var Le;(function(s){s.GENERATE_CONTENT="generateContent",s.STREAM_GENERATE_CONTENT="streamGenerateContent",s.COUNT_TOKENS="countTokens",s.EMBED_CONTENT="embedContent",s.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Le||(Le={}));class ru{constructor(e,t,n,r,a){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=a}toString(){var e,t;const n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||tu;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||eu}/${n}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function au(s){const e=[];return s!=null&&s.apiClient&&e.push(s.apiClient),e.push(`${su}/${nu}`),e.join(" ")}async function iu(s){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",au(s.requestOptions)),t.append("x-goog-api-key",s.apiKey);let n=(e=s.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(r){throw new ve(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${r.message}`)}for(const[r,a]of n.entries()){if(r==="x-goog-api-key")throw new ve(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new ve(`Header name ${r} can only be set using the apiClient field`);t.append(r,a)}}return t}async function ou(s,e,t,n,r,a){const i=new ru(s,e,t,n,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},hu(a)),{method:"POST",headers:await iu(i),body:r})}}async function Jt(s,e,t,n,r,a={},i=fetch){const{url:o,fetchOptions:c}=await ou(s,e,t,n,r,a);return cu(o,c,i)}async function cu(s,e,t=fetch){let n;try{n=await t(s,e)}catch(r){lu(r,s)}return n.ok||await uu(n,s),n}function lu(s,e){let t=s;throw t.name==="AbortError"?(t=new ec(`Request aborted when fetching ${e.toString()}: ${s.message}`),t.stack=s.stack):s instanceof Zo||s instanceof ve||(t=new K(`Error fetching from ${e.toString()}: ${s.message}`),t.stack=s.stack),t}async function uu(s,e){let t="",n;try{const r=await s.json();t=r.error.message,r.error.details&&(t+=` ${JSON.stringify(r.error.details)}`,n=r.error.details)}catch{}throw new Zo(`Error fetching from ${e.toString()}: [${s.status} ${s.statusText}] ${t}`,s.status,s.statusText,n)}function hu(s){const e={};if((s==null?void 0:s.signal)!==void 0||(s==null?void 0:s.timeout)>=0){const t=new AbortController;(s==null?void 0:s.timeout)>=0&&setTimeout(()=>t.abort(),s.timeout),s!=null&&s.signal&&s.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wr(s){return s.text=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),kn(s.candidates[0]))throw new Je(`${Ee(s)}`,s);return du(s)}else if(s.promptFeedback)throw new Je(`Text not available. ${Ee(s)}`,s);return""},s.functionCall=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),kn(s.candidates[0]))throw new Je(`${Ee(s)}`,s);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Oa(s)[0]}else if(s.promptFeedback)throw new Je(`Function call not available. ${Ee(s)}`,s)},s.functionCalls=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),kn(s.candidates[0]))throw new Je(`${Ee(s)}`,s);return Oa(s)}else if(s.promptFeedback)throw new Je(`Function call not available. ${Ee(s)}`,s)},s}function du(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const i of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)i.text&&a.push(i.text),i.executableCode&&a.push("\n```"+i.executableCode.language+`
`+i.executableCode.code+"\n```\n"),i.codeExecutionResult&&a.push("\n```\n"+i.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Oa(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const i of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)i.functionCall&&a.push(i.functionCall);if(a.length>0)return a}const fu=[Mt.RECITATION,Mt.SAFETY,Mt.LANGUAGE];function kn(s){return!!s.finishReason&&fu.includes(s.finishReason)}function Ee(s){var e,t,n;let r="";if((!s.candidates||s.candidates.length===0)&&s.promptFeedback)r+="Response was blocked",!((e=s.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${s.promptFeedback.blockReason}`),!((t=s.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(r+=`: ${s.promptFeedback.blockReasonMessage}`);else if(!((n=s.candidates)===null||n===void 0)&&n[0]){const a=s.candidates[0];kn(a)&&(r+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(r+=`: ${a.finishMessage}`))}return r}function Bt(s){return this instanceof Bt?(this.v=s,this):new Bt(s)}function mu(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),r,a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(g){n[g]&&(r[g]=function(u){return new Promise(function(_,y){a.push([g,u,_,y])>1||o(g,u)})})}function o(g,u){try{c(n[g](u))}catch(_){f(a[0][3],_)}}function c(g){g.value instanceof Bt?Promise.resolve(g.value.v).then(l,m):f(a[0][2],g)}function l(g){o("next",g)}function m(g){o("throw",g)}function f(g,u){g(u),a.shift(),a.length&&o(a[0][0],a[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ta=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function gu(s){const e=s.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=yu(e),[n,r]=t.tee();return{stream:_u(n),response:pu(r)}}async function pu(s){const e=[],t=s.getReader();for(;;){const{done:n,value:r}=await t.read();if(n)return wr(wu(e));e.push(r)}}function _u(s){return mu(this,arguments,function*(){const t=s.getReader();for(;;){const{value:n,done:r}=yield Bt(t.read());if(r)break;yield yield Bt(wr(n))}})}function yu(s){const e=s.getReader();return new ReadableStream({start(n){let r="";return a();function a(){return e.read().then(({value:i,done:o})=>{if(o){if(r.trim()){n.error(new K("Failed to parse stream"));return}n.close();return}r+=i;let c=r.match(Ta),l;for(;c;){try{l=JSON.parse(c[1])}catch{n.error(new K(`Error parsing JSON response: "${c[1]}"`));return}n.enqueue(l),r=r.substring(c[0].length),c=r.match(Ta)}return a()}).catch(i=>{let o=i;throw o.stack=i.stack,o.name==="AbortError"?o=new ec("Request aborted when reading from the stream"):o=new K("Error reading from the stream"),o})}}})}function wu(s){const e=s[s.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const n of s){if(n.candidates){let r=0;for(const a of n.candidates)if(t.candidates||(t.candidates=[]),t.candidates[r]||(t.candidates[r]={index:r}),t.candidates[r].citationMetadata=a.citationMetadata,t.candidates[r].groundingMetadata=a.groundingMetadata,t.candidates[r].finishReason=a.finishReason,t.candidates[r].finishMessage=a.finishMessage,t.candidates[r].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[r].content||(t.candidates[r].content={role:a.content.role||"user",parts:[]});const i={};for(const o of a.content.parts)o.text&&(i.text=o.text),o.functionCall&&(i.functionCall=o.functionCall),o.executableCode&&(i.executableCode=o.executableCode),o.codeExecutionResult&&(i.codeExecutionResult=o.codeExecutionResult),Object.keys(i).length===0&&(i.text=""),t.candidates[r].content.parts.push(i)}r++}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tc(s,e,t,n){const r=await Jt(e,Le.STREAM_GENERATE_CONTENT,s,!0,JSON.stringify(t),n);return gu(r)}async function nc(s,e,t,n){const a=await(await Jt(e,Le.GENERATE_CONTENT,s,!1,JSON.stringify(t),n)).json();return{response:wr(a)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sc(s){if(s!=null){if(typeof s=="string")return{role:"system",parts:[{text:s}]};if(s.text)return{role:"system",parts:[s]};if(s.parts)return s.role?s:{role:"system",parts:s.parts}}}function Ft(s){let e=[];if(typeof s=="string")e=[{text:s}];else for(const t of s)typeof t=="string"?e.push({text:t}):e.push(t);return bu(e)}function bu(s){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,r=!1;for(const a of s)"functionResponse"in a?(t.parts.push(a),r=!0):(e.parts.push(a),n=!0);if(n&&r)throw new K("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!r)throw new K("No content is provided for sending chat message.");return n?e:t}function Su(s,e){var t;let n={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const r=s.generateContentRequest!=null;if(s.contents){if(r)throw new ve("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=s.contents}else if(r)n=Object.assign(Object.assign({},n),s.generateContentRequest);else{const a=Ft(s);n.contents=[a]}return{generateContentRequest:n}}function Ma(s){let e;return s.contents?e=s:e={contents:[Ft(s)]},s.systemInstruction&&(e.systemInstruction=sc(s.systemInstruction)),e}function Au(s){return typeof s=="string"||Array.isArray(s)?{content:Ft(s)}:s}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pa=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],xu={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Ru(s){let e=!1;for(const t of s){const{role:n,parts:r}=t;if(!e&&n!=="user")throw new K(`First content should be with role 'user', got ${n}`);if(!xa.includes(n))throw new K(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(xa)}`);if(!Array.isArray(r))throw new K("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new K("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of r)for(const c of Pa)c in o&&(a[c]+=1);const i=xu[n];for(const o of Pa)if(!i.includes(o)&&a[o]>0)throw new K(`Content with role '${n}' can't contain '${o}' part`);e=!0}}function Na(s){var e;if(s.candidates===void 0||s.candidates.length===0)return!1;const t=(e=s.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const n of t.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const La="SILENT_ERROR";class Eu{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(Ru(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,a,i,o,c;await this._sendPromise;const l=Ft(e),m={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},f=Object.assign(Object.assign({},this._requestOptions),t);let g;return this._sendPromise=this._sendPromise.then(()=>nc(this._apiKey,this.model,m,f)).then(u=>{var _;if(Na(u.response)){this._history.push(l);const y=Object.assign({parts:[],role:"model"},(_=u.response.candidates)===null||_===void 0?void 0:_[0].content);this._history.push(y)}else{const y=Ee(u.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}g=u}).catch(u=>{throw this._sendPromise=Promise.resolve(),u}),await this._sendPromise,g}async sendMessageStream(e,t={}){var n,r,a,i,o,c;await this._sendPromise;const l=Ft(e),m={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,l]},f=Object.assign(Object.assign({},this._requestOptions),t),g=tc(this._apiKey,this.model,m,f);return this._sendPromise=this._sendPromise.then(()=>g).catch(u=>{throw new Error(La)}).then(u=>u.response).then(u=>{if(Na(u)){this._history.push(l);const _=Object.assign({},u.candidates[0].content);_.role||(_.role="model"),this._history.push(_)}else{const _=Ee(u);_&&console.warn(`sendMessageStream() was unsuccessful. ${_}. Inspect response object for details.`)}}).catch(u=>{u.message!==La&&console.error(u)}),g}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vu(s,e,t,n){return(await Jt(e,Le.COUNT_TOKENS,s,!1,JSON.stringify(t),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ku(s,e,t,n){return(await Jt(e,Le.EMBED_CONTENT,s,!1,JSON.stringify(t),n)).json()}async function $u(s,e,t,n){const r=t.requests.map(i=>Object.assign(Object.assign({},i),{model:e}));return(await Jt(e,Le.BATCH_EMBED_CONTENTS,s,!1,JSON.stringify({requests:r}),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=sc(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=Ma(e),a=Object.assign(Object.assign({},this._requestOptions),t);return nc(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}async generateContentStream(e,t={}){var n;const r=Ma(e),a=Object.assign(Object.assign({},this._requestOptions),t);return tc(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}startChat(e){var t;return new Eu(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=Su(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return vu(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=Au(e),r=Object.assign(Object.assign({},this._requestOptions),t);return ku(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return $u(this.apiKey,this.model,e,n)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new K("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Ba(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new ve("Cached content must contain a `name` field.");if(!e.model)throw new ve("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const i of r)if(t!=null&&t[i]&&e[i]&&(t==null?void 0:t[i])!==e[i]){if(i==="model"){const o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,c=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===c)continue}throw new ve(`Different value for "${i}" specified in modelParams (${t[i]}) and cachedContent (${e[i]})`)}const a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Ba(this.apiKey,a,n)}}const rc=[{code:"en",name:"English",nativeName:"English",direction:"ltr"},{code:"mn",name:"Mongolian",nativeName:"ÐœÐ¾Ð½Ð³Ð¾Ð»",direction:"ltr"},{code:"es",name:"Spanish",nativeName:"EspaÃ±ol",direction:"ltr"},{code:"fr",name:"French",nativeName:"FranÃ§ais",direction:"ltr"},{code:"de",name:"German",nativeName:"Deutsch",direction:"ltr"},{code:"pt",name:"Portuguese",nativeName:"PortuguÃªs",direction:"ltr"},{code:"it",name:"Italian",nativeName:"Italiano",direction:"ltr"},{code:"ja",name:"Japanese",nativeName:"æ—¥æœ¬èªž",direction:"ltr"},{code:"zh",name:"Chinese",nativeName:"ä¸­æ–‡",direction:"ltr"},{code:"ko",name:"Korean",nativeName:"í•œêµ­ì–´",direction:"ltr"},{code:"ar",name:"Arabic",nativeName:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",direction:"rtl"},{code:"hi",name:"Hindi",nativeName:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",direction:"ltr"},{code:"ru",name:"Russian",nativeName:"Ð ÑƒÑÑÐºÐ¸Ð¹",direction:"ltr"},{code:"nl",name:"Dutch",nativeName:"Nederlands",direction:"ltr"},{code:"tr",name:"Turkish",nativeName:"TÃ¼rkÃ§e",direction:"ltr"}];let Be=null,Un=null,Fe=null,jn="anthropic";function gh(s){Be=new jt({apiKey:s,dangerouslyAllowBrowser:!0})}function ph(s){Un=new C({apiKey:s,dangerouslyAllowBrowser:!0})}function _h(s){Fe=new Cu(s)}function yh(s){jn=s}function wh(){return jn}function bh(){return Be!==null}function Sh(){return Un!==null}function Ah(){return Fe!==null}function xh(){return Be!==null||Fe!==null}function ts(){return jn==="gemini"&&Fe?"gemini":jn==="anthropic"&&Be?"anthropic":Fe?"gemini":Be?"anthropic":null}const ac={twitter:{maxLength:280,style:"concise, punchy, uses 1-2 relevant emojis, includes a hook"},instagram:{maxLength:2200,style:"engaging, storytelling, uses emojis, includes call-to-action, hashtag-friendly"},linkedin:{maxLength:3e3,style:"professional, thought-leadership, insightful, uses line breaks for readability"},tiktok:{maxLength:300,style:"trendy, casual, uses gen-z language, hook in first line, emoji-heavy"},facebook:{maxLength:63206,style:"conversational, community-focused, shareable, uses emojis moderately, encourages engagement and discussion"}},ic={professional:"authoritative, data-driven, industry expert, credible",casual:"friendly, conversational, relatable, approachable",witty:"clever, humorous, uses wordplay, memorable one-liners",inspirational:"motivating, uplifting, visionary, empowering"};async function Iu(s,e){if(!Fe)throw new Error("Gemini API key not configured.");return(await Fe.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent({contents:[{role:"user",parts:[{text:`${s}

${e}`}]}]})).response.text().replace(/```json\n?/g,"").replace(/```\n?/g,"").trim()}async function Ou(s,e,t=1024){if(!Be)throw new Error("Anthropic API key not configured.");const r=(await Be.messages.create({model:"claude-sonnet-4-20250514",max_tokens:t,messages:[{role:"user",content:e}],system:s})).content.find(a=>a.type==="text");if(!r||r.type!=="text")throw new Error("No text content in response");return r.text}async function br(s,e,t=1024){const n=ts();if(!n)throw new Error("No AI provider configured. Please add an Anthropic or Gemini API key in Automation settings.");try{return n==="gemini"?await Iu(s,e):await Ou(s,e,t)}catch(r){throw Tu(r)}}async function Rh(s){if(!ts())throw new Error("No AI provider configured. Please add an Anthropic or Gemini API key in Automation settings.");const{topic:t,platform:n,tone:r,niche:a,targetAudience:i,includeHashtags:o=!0,additionalContext:c,language:l="en"}=s,m=ac[n],f=ic[r],g=rc.find(M=>M.code===l),u=(g==null?void 0:g.name)||"English",_=`You are an expert social media content creator specializing in viral, high-engagement content.

Your expertise:
- Creating platform-optimized content that drives engagement
- Understanding audience psychology and what makes content shareable
- Crafting hooks that stop the scroll
- Writing compelling calls-to-action
- Writing authentic, native-level content in multiple languages

Output format: Respond with valid JSON only, no markdown, no code blocks.
IMPORTANT: All content must be written in ${u}. Do not use any other language for the caption or call-to-action.`,y=`Create a ${n} post about: "${t}"

Requirements:
- Tone: ${f}
- Style: ${m.style}
- Maximum length: ${m.maxLength} characters for the main caption
- Language: Write ALL content in ${u} (${l})
${a?`- Niche/Industry: ${a}`:""}
${i?`- Target audience: ${i}`:""}
${c?`- Additional context: ${c}`:""}

Respond with this exact JSON structure:
{
  "caption": "The main post content in ${u} (under ${m.maxLength} chars)",
  "hashtags": ["relevant", "hashtags", "without", "hash", "symbol"],
  "hook": "The attention-grabbing first line in ${u}",
  "callToAction": "What you want the audience to do in ${u}"
}

${o?`Include 5-8 relevant hashtags that work well for ${u}-speaking audiences.`:"Do not include hashtags."}
Make the content authentic, not generic. Avoid clichÃ©s. Write in natural, native ${u}.`,R=await br(_,y,1024);try{const M=JSON.parse(R);return{caption:M.caption||"",hashtags:Array.isArray(M.hashtags)?M.hashtags:[],hook:M.hook||"",callToAction:M.callToAction||""}}catch{return{caption:R.slice(0,m.maxLength),hashtags:[],hook:"",callToAction:""}}}async function Eh(s,e=3){if(!ts())throw new Error("No AI provider configured. Please add an Anthropic or Gemini API key in Automation settings.");const{topic:n,platform:r,tone:a,language:i="en"}=s,o=ac[r],c=ic[a],l=rc.find(_=>_.code===i),m=(l==null?void 0:l.name)||"English",f=`You are an expert social media content creator. Generate multiple unique variations of content, each with a different angle or approach.

Output format: Respond with valid JSON only, no markdown, no code blocks.
IMPORTANT: All content must be written in ${m}. Do not use any other language.`,g=`Create ${e} different ${r} posts about: "${n}"

Requirements for each:
- Tone: ${c}
- Style: ${o.style}
- Maximum length: ${o.maxLength} characters
- Language: Write ALL content in ${m} (${i})
- Each variation should have a unique angle/approach

Respond with this exact JSON structure:
{
  "variations": [
    {
      "caption": "Post content in ${m}",
      "hashtags": ["relevant", "hashtags"],
      "angle": "Brief description of this variation's unique angle"
    }
  ]
}

Make each variation distinctly different while staying on topic. Write in natural, native ${m}.`,u=await br(f,g,2048);try{return JSON.parse(u).variations||[]}catch{return[]}}async function vh(s){var c,l;if(!Un)throw new Error("OpenAI API key not configured. Please add your API key in Settings.");const{prompt:e,style:t="vivid",size:n="1024x1024",quality:r="standard"}=s,a=`Create a modern, professional social media image: ${e}.
Style: Clean, high-quality, suitable for social media marketing.
Do not include any text or words in the image.`,o=(l=(c=(await Un.images.generate({model:"dall-e-3",prompt:a,n:1,size:n,style:t,quality:r})).data)==null?void 0:c[0])==null?void 0:l.url;if(!o)throw new Error("No image generated");return o}function Tu(s){const e=s instanceof Error?s.message:String(s);return e.includes("credit balance")||e.includes("too low")?new Error("API credits depleted. Please add credits at console.anthropic.com or update your API key."):e.includes("invalid_api_key")||e.includes("401")?new Error("Invalid API key. Please check your API key in Automation settings."):e.includes("rate_limit")||e.includes("429")?new Error("Rate limit exceeded. Please wait a moment and try again."):s instanceof Error?s:new Error(e)}async function kh(s,e,t){if(!ts())throw new Error("No AI provider configured. Please add an Anthropic or Gemini API key in Automation settings.");const r="You are a social media trend analyst. Respond with valid JSON only, no markdown, no code blocks.",a=`Analyze how relevant this trend is to the given niche and topics.

Trend: "${s}"
Niche: "${e}"
Topics of interest: ${t.join(", ")}

Respond with this exact JSON structure:
{
  "relevanceScore": 85,
  "reasoning": "Brief explanation of why this score",
  "suggestedAngles": ["angle 1", "angle 2", "angle 3"],
  "targetAudiences": ["audience 1", "audience 2"],
  "bestPlatforms": ["twitter", "linkedin"]
}

relevanceScore should be 0-100. Only include platforms from: twitter, instagram, linkedin, tiktok, facebook`,i=await br(r,a,512);try{return JSON.parse(i)}catch{return{relevanceScore:50,reasoning:"Unable to analyze",suggestedAngles:[],targetAudiences:[],bestPlatforms:["twitter"]}}}export{rc as S,kh as a,bh as b,ph as c,vh as d,Eh as e,Sh as f,Rh as g,_h as h,gh as i,br as j,xh as k,wh as l,Ah as m,yh as s};
